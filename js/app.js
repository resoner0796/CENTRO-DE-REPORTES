 (function(){const n=(function(){let w=!![];return function(o,d){const Y=w?function(){if(d){const e=d['apply'](o,arguments);return d=null,e;}}:function(){};return w=![],Y;};}()),B=n(this,function(){let w;try{const Y=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');w=Y();}catch(p){w=window;}const o=w['console']=w['console']||{},d=['log','warn','info','error','exception','table','trace'];for(let R=0x0;R<d['length'];R++){const F=n['constructor']['prototype']['bind'](n),a=d[R],D=o[a]||F;F['__proto__']=n['bind'](n),F['toString']=D['toString']['bind'](D),o[a]=F;}});B();const P=['rastreador-de-ordenes.firebaseapp.com','panel-logistica-simple.firebaseapp.com','localhost'];if(!P['includes'](window['location']['hostname'])){document['body']['innerHTML']='<div\x20style=\x22display:flex;justify-content:center;align-items:center;height:100vh;background:black;color:red;font-family:sans-serif;text-align:center;\x22><h1>丘멆잺\x20ACCESO\x20DENEGADO\x20丘멆잺<br>Sistema\x20protegido\x20por\x20Derechos\x20de\x20Autor.<br>Detecci칩n\x20de\x20clonaci칩n\x20activada.</h1></div>';throw new Error('Violaci칩n\x20de\x20Seguridad:\x20Ejecuci칩n\x20fuera\x20de\x20dominio\x20autorizado.');}}());const firebaseConfig={'apiKey':'AIzaSyDtlj3ppT9WBGMR60SZx0TZmAo3BXQWDXO','authDomain':'rastreador-de-ordenes.firebaseapp.com','projectId':'rastreador-de-ordenes','storageBucket':'rastreador-de-ordenes.appspot.com','messagingSenderId':'956052823395','appId':'1:956052823395:web:2ba74d9591d2b24c3cc756'};firebase['initializeApp'](firebaseConfig);const db=firebase['firestore']();document['addEventListener']('DOMContentLoaded',()=>{const I=IA=>document['getElementById'](IA),q={'menu':I('menuView'),'901':I('view901'),'terminaciones':I('viewTerminaciones'),'produccionHora':I('viewProduccionHora'),'tarimasConfirmadas':I('viewTarimasConfirmadas'),'boxID':I('viewBoxID'),'liveDashboard':I('viewLiveDashboard'),'ordenesDia':I('viewOrdenesDia')};let n={'isMaster':![]},B='menu',P={'901_config':{'columns':[],'userFilter':[]},'terminaciones_config':{'zpptwc_cols':[],'coois_cols':[],'final_cols':[],'area_config':{'source_col':'','mappings':[]},'fiber_rules':{}},'produccion_hora_config':{'packers':[]},'terminaciones_areas_config':{}},w=null,o={'zpptwc':null,'coois':null},d=null,Y=[],e=null,p=null,R=null,F=null;const a=new Date(),D=new Date();D['setDate'](a['getDate']()-0x6);if(I('term_fecha_inicio'))I('term_fecha_inicio')['value']=D['toISOString']()['split']('T')[0x0];if(I('term_fecha_fin'))I('term_fecha_fin')['value']=a['toISOString']()['split']('T')[0x0];I('consultarTerminacionesHistoricoBtn')&&I('consultarTerminacionesHistoricoBtn')['addEventListener']('click',Ie);function V(IA){const Ir=q[B],q0=q[IA];if(!q0)return;B=IA,Ir['style']['opacity']='0',setTimeout(()=>{Ir['style']['display']='none',q0['style']['display']='block';IA==='menu'&&(q0['style']['display']='flex');requestAnimationFrame(()=>{q0['style']['opacity']='1';});if(IA==='produccionHora')I7();else{if(IA==='tarimasConfirmadas'){const q1=new Date(),q2=q1['getFullYear'](),q3=String(q1['getMonth']()+0x1)['padStart'](0x2,'0'),q4=String(q1['getDate']())['padStart'](0x2,'0');I('prodTarimas_fecha')['value']=q2+'-'+q3+'-'+q4,I('prodTarimas_turno')['value']=I4(),J(),IH([]);}else IA==='boxID'&&(I('fileDropAreaBoxID')['style']['borderColor']='var(--border-color)');}},0x12c);}I('reporteProduccionBtn')['addEventListener']('click',()=>V('produccionHora')),I('reporteOrdenesDiaBtn')['addEventListener']('click',()=>{V('ordenesDia');if(!I('ordenesDia_fecha')['value']){const IA=new Date();I('ordenesDia_fecha')['value']=IA['toISOString']()['split']('T')[0x0];}}),I('view901Btn')['addEventListener']('click',()=>V('901')),I('reporteTerminacionesBtn')['addEventListener']('click',()=>V('terminaciones')),I('reporteTarimasBtn')['addEventListener']('click',()=>V('tarimasConfirmadas')),I('consultarTarimasBtn')['addEventListener']('click',IK),I('calcularTerminacionesDiaBtn')['addEventListener']('click',Ih),I('reporteBoxIDBtn')['addEventListener']('click',()=>V('boxID')),I('liveDashboardBtn')['addEventListener']('click',()=>l()),document['querySelectorAll']('.backToMenuBtn')['forEach'](IA=>IA['addEventListener']('click',()=>{B==='liveDashboard'&&u(),V('menu');}));let C=localStorage['getItem']('theme')||'dark';function S(IA){document['body']['className']=IA+'-theme',document['querySelectorAll']('.themeToggleBtn')['forEach'](Ir=>{const q0=Ir['querySelector']('.sun-icon'),q1=Ir['querySelector']('.moon-icon');q0&&q1&&(q0['style']['display']=IA==='light'?'none':'block',q1['style']['display']=IA==='light'?'block':'none');}),(d||fiberPieChart1||fiberPieChart2||p)&&IB();}document['querySelectorAll']('.themeToggleBtn')['forEach'](IA=>IA['addEventListener']('click',()=>{C=C==='light'?'dark':'light',localStorage['setItem']('theme',C),S(C);}));const j=I('modalOverlay');function W(IA,Ir){I('modalTitle')['textContent']=IA,I('modalBody')['innerHTML']=Ir,j['classList']['add']('visible');}function K(){j['classList']['remove']('visible');}I('modalClose')['addEventListener']('click',K),j['addEventListener']('click',IA=>{if(IA['target']===j)K();}),document['querySelectorAll']('.settingsBtn')['forEach'](IA=>IA['addEventListener']('click',()=>{n['isMaster']?h():H();}));function H(){const IA='<p\x20style=\x22text-align:\x20center;\x22>Introduce\x20las\x20credenciales\x20de\x20maestro.</p><input\x20type=\x22text\x22\x20id=\x22userInput\x22\x20placeholder=\x22Usuario\x22><input\x20type=\x22password\x22\x20id=\x22passInput\x22\x20placeholder=\x22Contrase침a\x22><button\x20id=\x22loginBtn\x22\x20class=\x22btn\x22\x20style=\x22margin-top:\x2016px;\x20width:\x20100%;\x22>Autenticar</button><div\x20id=\x22login-error-msg\x22></div>';W('Autenticaci칩n\x20Maestra',IA),I('loginBtn')['addEventListener']('click',m);}function m(){const IA=I('login-error-msg');I('userInput')['value']==='LUNAU'&&I('passInput')['value']==='Resoner96'?(n['isMaster']=!![],sessionStorage['setItem']('reportesMasterSession','true'),K(),h()):IA['textContent']='Credenciales\x20incorrectas.';}function h(){if(B==='901'){const IA=P['901_config'],Ir=(IA['userFilter']||[])['join'](',\x20'),q0='<ul\x20class=\x22param-list\x20param-list-901\x22>'+(IA['columns']||[])['map'](q2=>N(q2['key'],q2['startCell']))['join']('')+'</ul>',q1='<div\x20class=\x22user-filter-container\x22><label\x20for=\x22userFilterInput\x22>Filtrar\x20por\x20Usuarios\x20(separados\x20por\x20coma)</label><textarea\x20id=\x22userFilterInput\x22\x20placeholder=\x22PINTORA2,\x20LUNAU2...\x20(dejar\x20vac칤o\x20para\x20incluir\x20a\x20todos)\x22>'+Ir+'</textarea></div><hr\x20style=\x22border-color:\x20var(--border-color);\x20margin:\x2016px\x200;\x22><p\x20style=\x22text-align:center;\x22>Define\x20los\x20nombres\x20de\x20columna\x20y\x20la\x20celda\x20de\x20inicio\x20de\x20cada\x20una\x20(ej.\x20A2).</p>'+q0+'<button\x20id=\x22addParam901Btn\x22\x20class=\x22btn\x22\x20style=\x22width:\x20auto;\x20padding:\x208px\x2016px;\x22>A침adir\x20Columna</button><button\x20id=\x22saveParams901Btn\x22\x20class=\x22btn\x22\x20style=\x22margin-top:\x2020px;\x20width:\x20100%;\x22>Guardar\x20Mapeo\x20y\x20Filtros</button>';W('Configurar\x20Mapeo\x20y\x20Filtros\x20de\x20901',q1),I('addParam901Btn')['addEventListener']('click',()=>I('modalBody')['querySelector']('.param-list-901')['insertAdjacentHTML']('beforeend',N('',''))),I('saveParams901Btn')['addEventListener']('click',G);}else{if(B==='terminaciones')M();else{if(B==='produccionHora')x();else B==='tarimasConfirmadas'&&showAreaConfig();}}}function x(){const IA=P['produccion_hora_config'],Ir='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22collapsible-section\x20open\x22\x20id=\x22packerRegistrySection\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22collapsible-header\x22>Base\x20de\x20Datos\x20de\x20Empacadores</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22collapsible-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>A침ada,\x20edite\x20o\x20elimine\x20empacadores\x20para\x20autocompletar\x20en\x20el\x20panel\x20de\x20control.\x20Los\x20cambios\x20se\x20guardan\x20al\x20presionar\x20el\x20bot칩n\x20de\x20abajo.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<form\x20id=\x22addPackerForm\x22>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20<input\x20type=\x22text\x22\x20id=\x22newPackerId\x22\x20placeholder=\x22ID\x20Empacador\x22\x20required>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20<select\x20id=\x22newPackerArea\x22>'+I('prod_area')['innerHTML']+'</select>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20id=\x22newPackerLinea\x22\x20placeholder=\x22L칤nea\x20#\x22\x20required\x20min=\x221\x22\x20style=\x22width:\x20100%;\x20padding:\x208px;\x20box-sizing:\x20border-box;\x20border-radius:\x206px;\x20border:\x201px\x20solid\x20var(--border-color);\x20background:\x20var(--surface-color);\x20color:\x20var(--text-primary);\x22>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20<select\x20id=\x22newPackerTurno\x22\x20required>'+I('prod_turno')['innerHTML']+'</select>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20<button\x20type=\x22submit\x22\x20class=\x22btn\x22\x20style=\x22padding:\x208px\x2012px;\x20font-size:\x201rem;\x22>+</button>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20id=\x22packerList\x22></ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22saveProduccionHoraConfigBtn\x22\x20class=\x22btn\x22\x20style=\x22margin-top:\x2020px;\x20width:\x20100%;\x22>Guardar\x20Base\x20de\x20Datos</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';W('Configurar\x20Empacadores',Ir),I('saveProduccionHoraConfigBtn')['addEventListener']('click',L);const q0=I('packerRegistrySection');q0['querySelector']('.collapsible-header')['addEventListener']('click',()=>{q0['classList']['toggle']('open');}),I('addPackerForm')['addEventListener']('submit',q1=>{q1['preventDefault']();const q2={'id':I('newPackerId')['value']['trim']()['toUpperCase'](),'area':I('newPackerArea')['value'],'linea':I('newPackerLinea')['value'],'turno':I('newPackerTurno')['value']},q3=P['produccion_hora_config']['packers']['some'](q4=>q4['id']===q2['id']&&q4['linea']===q2['linea']&&q4['turno']===q2['turno']);if(q2['id']&&!q3)P['produccion_hora_config']['packers']['push'](q2),Z(),I('newPackerId')['value']='';else q2['id']&&q3&&alert('Error:\x20Ese\x20empacador\x20ya\x20est치\x20registrado\x20en\x20esa\x20misma\x20l칤nea\x20y\x20turno.');}),Z();}function Z(){const IA=I('packerList');if(!IA)return;const Ir=P['produccion_hora_config']['packers']||[];Ir['sort']((q0,q1)=>q0['id']['localeCompare'](q1['id'])),IA['innerHTML']=Ir['map']((q0,q1)=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span><strong>'+q0['id']+'</strong></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+q0['area']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>L칤nea\x20'+q0['linea']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+q0['turno']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-danger\x22\x20data-index=\x22'+q1+'\x22\x20style=\x22font-size:\x200.8rem;\x20padding:\x204px\x208px;\x22>X</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')['join'](''),IA['querySelectorAll']('.btn-danger')['forEach'](q0=>{q0['addEventListener']('click',q1=>{const q2=parseInt(q1['target']['dataset']['index'],0xa);P['produccion_hora_config']['packers']['splice'](q2,0x1),Z();});});}async function L(){const IA={'packers':P['produccion_hora_config']['packers']||[]};try{await db['collection']('report_configs')['doc']('produccion_hora_params')['set'](IA),P['produccion_hora_config']=IA,E(),W('칄xito','<p>Base\x20de\x20datos\x20de\x20empacadores\x20guardada.</p>');}catch(Ir){W('Error','<p>No\x20se\x20pudo\x20guardar\x20la\x20configuraci칩n.</p>');}}function N(IA,Ir){return'<li\x20class=\x22param-item\x22\x20style=\x22grid-template-columns:\x201fr\x201fr\x20auto;\x22><input\x20type=\x22text\x22\x20class=\x22param-key\x22\x20placeholder=\x22Nombre\x20de\x20Columna\x22\x20value=\x22'+(IA||'')+'\x22><input\x20type=\x22text\x22\x20class=\x22param-cell\x22\x20placeholder=\x22Celda\x20de\x20Inicio\x20(ej.\x20A2)\x22\x20value=\x22'+(Ir||'')+'\x22><button\x20class=\x22btn\x20btn-danger\x22\x20onclick=\x22this.parentElement.remove()\x22>X</button></li>';}async function G(){const IA=Array['from'](I('modalBody')['querySelectorAll']('.param-item'))['map'](q1=>({'key':q1['querySelector']('.param-key')['value']['trim'](),'startCell':q1['querySelector']('.param-cell')['value']['trim']()['toUpperCase']()}))['filter'](q1=>q1['key']&&q1['startCell']),Ir=I('userFilterInput')['value']['split'](',')['map'](q1=>q1['trim']())['filter'](Boolean),q0={'columns':IA,'userFilter':Ir};try{await db['collection']('report_configs')['doc']('901_params')['set'](q0),P['901_config']=q0,W('칄xito','<p>Mapeo\x20y\x20filtros\x20de\x20901\x20guardados.</p>');}catch(q1){W('Error','<p>No\x20se\x20pudo\x20guardar\x20la\x20configuraci칩n.</p>');}}function M(){const IA=P['terminaciones_config'];if(!IA['fiber_rules'])IA['fiber_rules']={};const Ir='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-tabs\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22tab-btn\x20active\x22\x20data-tab=\x22zpptwc\x22>1.\x20Mapeo\x20Zpptwc</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22tab-btn\x22\x20data-tab=\x22coois\x22>2.\x20Mapeo\x20Coois</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22tab-btn\x22\x20data-tab=\x22areas\x22>3.\x20Mapeo\x20de\x20츼reas</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22tab-btn\x22\x20data-tab=\x22final\x22>4.\x20Columnas\x20Finales</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22tab-btn\x22\x20data-tab=\x22reglas\x22>5.\x20Reglas\x20Fibras</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22tab-zpptwc\x22\x20class=\x22tab-content\x20active\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Define\x20un\x20nombre\x20clave\x20y\x20la\x20letra\x20de\x20la\x20columna\x20para\x20Zpptwc.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22param-list\x22>'+(IA['zpptwc_cols']||[])['map'](q6=>T(q6['key'],q6['excel_col']))['join']('')+'</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22tab-coois\x22\x20class=\x22tab-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Define\x20un\x20nombre\x20clave\x20y\x20la\x20letra\x20de\x20la\x20columna\x20para\x20Coois.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22param-list\x22>'+(IA['coois_cols']||[])['map'](q6=>T(q6['key'],q6['excel_col']))['join']('')+'</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22tab-areas\x22\x20class=\x22tab-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22area-source-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Columna\x20Clave\x20de\x20Coois\x20(ej.\x20MRP)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22area-source-col\x22\x20value=\x22'+((IA['area_config']||{})['source_col']||'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22area-list\x22>'+((IA['area_config']||{})['mappings']||[])['map'](q6=>b(q6['code'],q6['name']))['join']('')+'</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22tab-final\x22\x20class=\x22tab-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Columnas\x20finales\x20del\x20reporte\x20unificado.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22param-list\x22>'+(IA['final_cols']||[])['map'](q6=>t(q6['key'],q6['type'],q6['value']))['join']('')+'</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22tab-reglas\x22\x20class=\x22tab-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22control-group\x22\x20style=\x22margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Seleccionar\x20츼rea\x20para\x20Configurar:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<select\x20id=\x22ruleAreaSelect\x22\x20class=\x22filter-input\x22\x20style=\x22padding:8px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22\x22\x20disabled\x20selected>Selecciona\x20un\x20치rea...</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</select>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:0.8rem;\x20color:var(--text-secondary);\x20margin-top:5px;\x22>Define\x20c칩mo\x20leer\x20las\x20fibras.\x20Pon\x20<strong>Len:\x200</strong>\x20para\x20usar\x20el\x20Multiplicador\x20como\x20valor\x20fijo.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22rulesContainer\x22\x20style=\x22border:\x201px\x20solid\x20var(--border-color);\x20padding:\x2010px;\x20border-radius:\x208px;\x20min-height:\x20200px;\x20max-height:\x20300px;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:center;\x20color:var(--text-dark);\x20margin-top:\x2020px;\x22>Primero\x20selecciona\x20un\x20치rea\x20arriba.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22addRuleBtn\x22\x20class=\x22btn\x20btn-glass\x22\x20style=\x22width:100%;\x20margin-top:10px;\x20display:none;\x22>+\x20A침adir\x20Regla</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22\x20style=\x22display:flex;\x20gap:10px;\x20margin-top:20px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22addBtn\x20btn\x22\x20style=\x22flex:1;\x22>A침adir\x20Fila\x20(Tabs\x201-4)</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22saveTerminacionesSettingsBtn\x22\x20class=\x22btn\x22\x20style=\x22flex:2;\x22>Guardar\x20Todo</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>';W('Configurar\x20Terminaciones',Ir);const q0=I('modalBody');q0['querySelectorAll']('.tab-btn')['forEach'](q6=>q6['addEventListener']('click',()=>{q0['querySelectorAll']('.tab-btn,\x20.tab-content')['forEach'](q7=>q7['classList']['remove']('active')),q6['classList']['add']('active'),I('tab-'+q6['dataset']['tab'])['classList']['add']('active');if(q6['dataset']['tab']==='reglas')q4();})),q0['querySelector']('.addBtn')['addEventListener']('click',()=>{const q6=q0['querySelector']('.tab-content.active');if(q6['id']==='tab-areas')q6['querySelector']('.area-list')['insertAdjacentHTML']('beforeend',b('',''));else{if(q6['id']==='tab-final')q6['querySelector']('.param-list')['insertAdjacentHTML']('beforeend',t('','source',''));else{if(q6['id']==='tab-reglas'){}else q6['querySelector']('.param-list')['insertAdjacentHTML']('beforeend',T('',''));}}}),I('saveTerminacionesSettingsBtn')['addEventListener']('click',v);const q1=I('ruleAreaSelect'),q2=I('rulesContainer'),q3=I('addRuleBtn');function q4(){const q6=q1['value'];q1['innerHTML']='<option\x20value=\x22DEFAULT\x22>DEFAULT\x20(General)</option>';const q7=document['querySelectorAll']('#tab-areas\x20.area-name'),q8=new Set();q7['forEach'](q9=>{if(q9['value'])q8['add'](q9['value']['trim']()['toUpperCase']());}),q8['forEach'](q9=>{const qI=document['createElement']('option');qI['value']=q9,qI['textContent']=q9,q1['appendChild'](qI);});if(q6)q1['value']=q6;}q1['addEventListener']('change',()=>{const q6=q1['value'];q3['style']['display']='block',q5(q6);});function q5(q6){const q7=IA['fiber_rules'][q6]||[];q7['length']===0x0?q2['innerHTML']='<p\x20style=\x22text-align:center;\x20font-style:italic;\x20opacity:0.7;\x22>No\x20hay\x20reglas\x20espec칤ficas.\x20Se\x20usar치\x20el\x20c치lculo\x20por\x20defecto.</p>':q2['innerHTML']='<ul\x20class=\x22param-list\x22>'+q7['map'](q8=>y(q8))['join']('')+'</ul>';}q3['addEventListener']('click',()=>{const q6=q1['value'];if(!IA['fiber_rules'][q6])IA['fiber_rules'][q6]=[];IA['fiber_rules'][q6]['push']({'prefix':'','start':0x4,'length':0x1,'t_equals_12':!![],'multiplier':0x1}),q5(q6);}),q2['addEventListener']('input',q6=>{const q7=q6['target']['closest']('.rule-item');if(!q7)return;const q8=Array['from'](q7['parentNode']['children'])['indexOf'](q7),q9=q1['value'],qI=IA['fiber_rules'][q9][q8];if(q6['target']['classList']['contains']('rule-prefix'))qI['prefix']=q6['target']['value']['toUpperCase']();if(q6['target']['classList']['contains']('rule-start')){const qq=parseInt(q6['target']['value']);qI['start']=isNaN(qq)?0x4:qq;}if(q6['target']['classList']['contains']('rule-len')){const qQ=parseInt(q6['target']['value']);qI['length']=isNaN(qQ)?0x1:qQ;}if(q6['target']['classList']['contains']('rule-mult')){const qf=parseInt(q6['target']['value']);qI['multiplier']=isNaN(qf)?0x1:qf;}if(q6['target']['classList']['contains']('rule-check'))qI['t_equals_12']=q6['target']['checked'];}),q2['addEventListener']('click',q6=>{if(q6['target']['classList']['contains']('btn-del-rule')){const q7=q6['target']['closest']('.rule-item'),q8=Array['from'](q7['parentNode']['children'])['indexOf'](q7),q9=q1['value'];IA['fiber_rules'][q9]['splice'](q8,0x1),q5(q9);}});}function y(IA){const Ir=IA['length']!==undefined&&IA['length']!==null?IA['length']:0x1,q0=IA['multiplier']!==undefined&&IA['multiplier']!==null?IA['multiplier']:0x1,q1=IA['start']!==undefined&&IA['start']!==null?IA['start']:0x4;return'\x0a\x20\x20\x20\x20<li\x20class=\x22rule-item\x22\x20style=\x22display:\x20grid;\x20grid-template-columns:\x201.2fr\x200.8fr\x200.8fr\x200.8fr\x20auto\x20auto;\x20gap:\x206px;\x20align-items:\x20center;\x20padding:\x208px;\x20background:\x20var(--surface-hover-color);\x20margin-bottom:\x206px;\x20border-radius:\x206px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22rule-prefix\x22\x20placeholder=\x22Prefijo\x20(ej.\x20DFB)\x22\x20value=\x22'+(IA['prefix']||'')+'\x22\x20title=\x22Empieza\x20con...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20class=\x22rule-start\x22\x20placeholder=\x22Pos\x22\x20value=\x22'+q1+'\x22\x20title=\x22Posici칩n\x20inicial\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20class=\x22rule-len\x22\x20placeholder=\x22Len\x22\x20value=\x22'+Ir+'\x22\x20title=\x22Longitud\x20(0\x20para\x20valor\x20fijo)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20class=\x22rule-mult\x22\x20placeholder=\x22x\x22\x20value=\x22'+q0+'\x22\x20title=\x22Multiplicador\x20(o\x20Valor\x20Fijo\x20si\x20Len=0)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-size:0.7rem;\x20display:flex;\x20align-items:center;\x20gap:2px;\x20cursor:pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22rule-check\x22\x20'+(IA['t_equals_12']?'checked':'')+'>\x20T=12\x0a\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-danger\x20btn-del-rule\x22\x20style=\x22padding:\x202px\x206px;\x22>X</button>\x0a\x20\x20\x20\x20</li>';}function T(IA,Ir){return'<li\x20class=\x22param-item\x22\x20draggable=\x22true\x22\x20style=\x22grid-template-columns:\x20auto\x201fr\x201fr\x20auto;\x22><span\x20class=\x22drag-handle\x22\x20title=\x22Arrastrar\x20para\x20reordenar\x22><svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><circle\x20cx=\x2212\x22\x20cy=\x225\x22\x20r=\x221\x22></circle><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x221\x22></circle><circle\x20cx=\x2212\x22\x20cy=\x2219\x22\x20r=\x221\x22></circle><circle\x20cx=\x225\x22\x20cy=\x225\x22\x20r=\x221\x22></circle><circle\x20cx=\x225\x22\x20cy=\x2212\x22\x20r=\x221\x22></circle><circle\x20cx=\x225\x22\x20cy=\x2219\x22\x20r=\x221\x22></circle><circle\x20cx=\x2219\x22\x20cy=\x225\x22\x20r=\x221\x22></circle><circle\x20cx=\x2219\x22\x20cy=\x2212\x22\x20r=\x221\x22></circle><circle\x20cx=\x2219\x22\x20cy=\x2219\x22\x20r=\x221\x22></circle></svg></span><input\x20type=\x22text\x22\x20class=\x22param-key\x22\x20placeholder=\x22Nombre\x20de\x20Columna\x22\x20value=\x22'+(IA||'')+'\x22><input\x20type=\x22text\x22\x20class=\x22param-excel-col\x22\x20placeholder=\x22Letra\x20de\x20Columna\x20(ej.\x20A)\x22\x20value=\x22'+(Ir||'')+'\x22><button\x20class=\x22btn\x20btn-danger\x22\x20onclick=\x22this.parentElement.remove()\x22>X</button></li>';}function b(IA,Ir){return'<li\x20class=\x22area-item\x22\x20style=\x22grid-template-columns:\x201fr\x202fr\x20auto;\x22><input\x20type=\x22text\x22\x20class=\x22area-code\x22\x20placeholder=\x22C칩digo\x20MRP\x22\x20value=\x22'+(IA||'')+'\x22><input\x20type=\x22text\x22\x20class=\x22area-name\x22\x20placeholder=\x22Nombre\x20de\x20츼rea\x22\x20value=\x22'+(Ir||'')+'\x22><button\x20class=\x22btn\x20btn-danger\x22\x20onclick=\x22this.parentElement.remove()\x22>X</button></li>';}function t(IA,Ir,q0){const q1='<option\x20value=\x22source\x22>Dato\x20Directo</option><option\x20value=\x22formula\x22>F칩rmula\x20(Avanzado)</option><option\x20value=\x22fibras_auto\x22>Fibras\x20(Autom치tico)</option><option\x20value=\x22terminaciones_auto\x22>Terminaciones\x20(Autom치tico)</option><option\x20value=\x22familia_auto\x22>Familia\x20(Autom치tico)</option>';let q2=q1['replace']('value=\x22'+Ir+'\x22','value=\x22'+Ir+'\x22\x20selected');const q3=Ir==='formula',q4=Ir==='source',q5=!q3&&!q4;return'<li\x20class=\x22param-item\x22\x20draggable=\x22true\x22\x20style=\x22grid-template-columns:auto\x201fr\x201.2fr\x202fr\x20auto\x22><span\x20class=\x22drag-handle\x22\x20title=\x22Arrastrar\x20para\x20reordenar\x22><svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><circle\x20cx=\x2212\x22\x20cy=\x225\x22\x20r=\x221\x22></circle><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x221\x22></circle><circle\x20cx=\x2212\x22\x20cy=\x2219\x22\x20r=\x221\x22></circle><circle\x20cx=\x225\x22\x20cy=\x225\x22\x20r=\x221\x22></circle><circle\x20cx=\x225\x22\x20cy=\x2212\x22\x20r=\x221\x22></circle><circle\x20cx=\x225\x22\x20cy=\x2219\x22\x20r=\x221\x22></circle><circle\x20cx=\x2219\x22\x20cy=\x225\x22\x20r=\x221\x22></circle><circle\x20cx=\x2219\x22\x20cy=\x2212\x22\x20r=\x221\x22></circle><circle\x20cx=\x2219\x22\x20cy=\x2219\x22\x20r=\x221\x22></circle></svg></span><input\x20type=\x22text\x22\x20class=\x22param-key\x22\x20placeholder=\x22Nombre\x20Columna\x20Final\x22\x20value=\x22'+(IA||'')+'\x22><select\x20class=\x22param-type\x22>'+q2+'</select><div\x20class=\x22'+(q5?'hidden':'')+'\x22><input\x20type=\x22text\x22\x20class=\x22param-value-input\x22\x20placeholder=\x22'+(q3?'Escribe\x20f칩rmula...':'Nombre\x20Clave\x20de\x20la\x20fuente')+'\x22\x20value=\x22'+(q0||'')+'\x22\x20onfocus=\x22populateFormulaHelpers(this,\x20'+q3+')\x22><div\x20class=\x22formula-helpers\x22></div></div><button\x20class=\x22btn\x20btn-danger\x22\x20onclick=\x22this.parentElement.remove()\x22>X</button></li>';}function O(IA,Ir){const q0=[...IA['querySelectorAll']('.param-item:not(.dragging)')];return q0['reduce']((q1,q2)=>{const q3=q2['getBoundingClientRect'](),q4=Ir-q3['top']-q3['height']/0x2;return q4<0x0&&q4>q1['offset']?{'offset':q4,'element':q2}:q1;},{'offset':Number['NEGATIVE_INFINITY']})['element'];}window['populateFormulaHelpers']=(IA,Ir)=>{const q0=IA['nextElementSibling'];q0['innerHTML']='';if(!Ir)return;const q1=IA['closest']('#modalBody');if(!q1)return;const q2=IA['closest']('.param-item')['querySelector']('.param-key')['value'],q3=Array['from'](q1['querySelectorAll']('#tab-zpptwc\x20.param-item'))['map'](q8=>q8['querySelector']('.param-key')['value']),q4=Array['from'](q1['querySelectorAll']('#tab-coois\x20.param-item'))['map'](q8=>q8['querySelector']('.param-key')['value']),q5=Array['from'](q1['querySelectorAll']('#tab-final\x20.param-item'))['map'](q8=>q8['querySelector']('.param-key')['value']),q6=[...q3,...q4,...q5['filter'](q8=>q8!==q2),'Area']['filter'](Boolean),q7=[...new Set(q6)];q7['forEach'](q8=>{const q9=document['createElement']('button');q9['className']='helper-pill',q9['textContent']=q8,q9['onclick']=qI=>{qI['preventDefault'](),k(IA,'{'+q8+'}');},q0['appendChild'](q9);});};function k(IA,Ir){const q0=IA['selectionStart'];IA['value']=IA['value']['substring'](0x0,q0)+Ir+IA['value']['substring'](IA['selectionEnd']),IA['focus'](),IA['selectionEnd']=q0+Ir['length'];}I('modalOverlay')['addEventListener']('change',IA=>{if(IA['target']['classList']['contains']('param-type')){const Ir=IA['target']['closest']('.param-item'),q0=Ir['querySelector']('div:not(.formula-helpers)'),q1=['fibras_auto','terminaciones_auto','familia_auto']['includes'](IA['target']['value']);if(q0)q0['classList']['toggle']('hidden',q1);}});async function v(){try{const IA=document['getElementById']('modalBody');if(!IA)throw new Error('Modal\x20no\x20encontrado');const Ir={'zpptwc_cols':Array['from'](IA['querySelectorAll']('#tab-zpptwc\x20.param-item'))['map'](q0=>({'key':q0['querySelector']('.param-key')['value']['trim'](),'excel_col':q0['querySelector']('.param-excel-col')['value']['trim']()['toUpperCase']()})),'coois_cols':Array['from'](IA['querySelectorAll']('#tab-coois\x20.param-item'))['map'](q0=>({'key':q0['querySelector']('.param-key')['value']['trim'](),'excel_col':q0['querySelector']('.param-excel-col')['value']['trim']()['toUpperCase']()})),'area_config':{'source_col':IA['querySelector']('#area-source-col')['value']['trim'](),'mappings':Array['from'](IA['querySelectorAll']('#tab-areas\x20.area-item'))['map'](q0=>({'code':q0['querySelector']('.area-code')['value'],'name':q0['querySelector']('.area-name')['value']}))},'final_cols':Array['from'](IA['querySelectorAll']('#tab-final\x20.param-item'))['map'](q0=>({'key':q0['querySelector']('.param-key')['value']['trim'](),'type':q0['querySelector']('.param-type')['value'],'value':q0['querySelector']('.param-value-input')['value']['trim']()})),'fiber_rules':P['terminaciones_config']['fiber_rules']||{}};await db['collection']('report_configs')['doc']('terminaciones_params_v2')['set'](Ir),P['terminaciones_config']=Ir,W('칄xito','<p>Configuraci칩n\x20guardada.\x20Las\x20reglas\x20de\x20fibras\x20ahora\x20son\x20din치micas.</p>');}catch(q0){console['error']('Error\x20guardando\x20config:',q0),W('Error','<p>No\x20se\x20pudo\x20guardar:\x20'+q0['message']+'</p>');}}async function z(IA){const Ir={'901_config':'901_params','terminaciones_config':'terminaciones_params_v2','produccion_hora_config':'produccion_hora_params','terminaciones_areas_config':'terminaciones_areas_params'},q0=Ir[IA];if(!q0)return;try{const q1=await db['collection']('report_configs')['doc'](q0)['get']();if(q1['exists']){const q2=q1['data']();if(IA==='901_config')P[IA]={'columns':q2['columns']||[],'userFilter':q2['userFilter']||[]};else{if(IA==='terminaciones_config')P['terminaciones_config']={'zpptwc_cols':[],'coois_cols':[],'final_cols':[],'area_config':{'source_col':'','mappings':[]},...q2};else{if(IA==='produccion_hora_config')P['produccion_hora_config']={'packers':[],...q2},E();else{if(IA==='terminaciones_areas_config'){if(!P['terminaciones_areas_config'])P['terminaciones_areas_config']={};P['terminaciones_areas_config']={...P['terminaciones_areas_config'],...q2};}}}}}}catch(q3){console['error']('Error\x20al\x20cargar\x20'+IA+':',q3);}}function E(){}function i(){const IA=I('prod_turno')['value'],Ir=I('prod_area')['value'],q0=P['produccion_hora_config']['packers']||[],q1=I('packerSelectsContainer'),q2=q0['filter'](q5=>q5['turno']===IA&&(q5['area']===Ir||Ir==='ALL'||q5['area']==='ALL')),q3=[...new Set(q2['map'](q5=>q5['linea']))]['sort']((q5,q6)=>q5-q6),q4={};q1['querySelectorAll']('select')['forEach'](q5=>{q4[q5['id']]=q5['value'];}),q1['innerHTML']='',q3['forEach'](q5=>{const q6='prod_linea'+q5+'_packer',q7=q2['filter'](qI=>qI['linea']===q5);let q8='<option\x20value=\x22\x22\x20disabled\x20selected>Seleccionar...</option>';q7['sort']((qI,qq)=>qI['id']['localeCompare'](qq['id']))['forEach'](qI=>{q8+='<option\x20value=\x22'+qI['id']+'\x22>'+qI['id']+'</option>';});const q9='\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20<div\x20class=\x22control-group\x22\x20style=\x22display:\x20block;\x22>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20<label\x20for=\x22'+q6+'\x22>Empacador\x20L칤nea\x20'+q5+'</label>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20<select\x20id=\x22'+q6+'\x22>'+q8+'</select>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20</div>\x0a\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20\u00a0\x20';q1['insertAdjacentHTML']('beforeend',q9),q4[q6]&&q7['some'](qI=>qI['id']===q4[q6])&&(I(q6)['value']=q4[q6]);});}I('prod_turno')['addEventListener']('change',i),I('prod_area')['addEventListener']('change',i);function U(IA,Ir,q0){const q1=I(IA),q2=I(Ir);if(!q1||!q2)return;const q3=q4=>{q4&&q4['length']&&c(q4,q0);};q1['addEventListener']('click',()=>q2['click']()),q2['addEventListener']('change',q4=>{q3(q4['target']['files']),q4['target']['value']='';}),q1['addEventListener']('dragover',q4=>q4['preventDefault']()),q1['addEventListener']('drop',q4=>{q4['preventDefault'](),q3(q4['dataTransfer']['files']);});}U('fileDropArea901','fileInput901','901'),U('fileDropAreaZpptwc','fileInputZpptwc','zpptwc'),U('fileDropAreaCoois','fileInputCoois','coois'),U('fileDropAreaBoxID','fileInputBoxID','boxID'),U('fileDropAreaGrUsuarios','fileInputGrUsuarios','grUsuarios');function c(IA,Ir){const q0=['901','zpptwc','coois'];if(Ir==='boxID')I0(IA);else{if(Ir==='grUsuarios')I1(IA);else{if(q0['includes'](Ir)){const q1=IA[0x0];if(!q1)return;if(Ir==='901')IV(q1);if(Ir==='zpptwc'||Ir==='coois'){const q2=new FileReader();q2['onload']=async q3=>{try{const q4=XLSX['read'](new Uint8Array(q3['target']['result']),{'type':'array','cellDates':!![]}),q5=q4['Sheets'][q4['SheetNames'][0x0]],q6=Ir==='zpptwc'?P['terminaciones_config']['zpptwc_cols']:P['terminaciones_config']['coois_cols'],q7=XLSX['utils']['sheet_to_json'](q5,{'header':'A','defval':null,'range':0x1}),q8=q7['map'](q9=>{let qI={};for(const qq of q6){if(qq['excel_col'])qI[qq['key']]=q9[qq['excel_col']];}return qI;})['filter'](q9=>q9['Orden']);o[Ir]=q8,I('fileDropArea'+(Ir['charAt'](0x0)['toUpperCase']()+Ir['slice'](0x1)))['style']['borderColor']='#4ade80';if(Ir==='coois'){const q9=db['batch']();q8['forEach'](qI=>{const qq=String(qI['Orden']||'')['replace'](/^0+/,'');if(qq){const qQ=db['collection']('coois_historico')['doc'](qq);q9['set'](qQ,qI,{'merge':!![]});}}),await q9['commit']();}Id();}catch(qI){console['error']('Error\x20al\x20procesar\x20archivo:',qI),W('Error\x20de\x20Archivo','<p>No\x20se\x20pudo\x20procesar\x20el\x20archivo\x20Excel.\x20Verifique\x20el\x20mapeo\x20de\x20letras\x20de\x20columna\x20y\x20la\x20conexi칩n\x20a\x20la\x20base\x20de\x20datos.</p>');}},q2['readAsArrayBuffer'](q1);}}}}}const s={'EXTRAER':(IA,Ir,q0)=>typeof IA!=='string'||IA===null?'':String(IA)['substring'](Ir-0x1,Ir-0x1+q0),'EXTRAER_FIBRAS':(IA,Ir,q0)=>{if(typeof IA!=='string'||IA===null)return 0x0;const q1=String(IA)['substring'](Ir-0x1,Ir-0x1+q0)['toUpperCase']();if(!q1)return 0x0;switch(q1){case'1':return 0x1;case'2':return 0x2;case'3':return 0x3;case'4':return 0x4;case'5':return 0x5;case'6':return 0x6;case'7':return 0x7;case'8':return 0x8;case'9':return 0x9;case'A':return 0x1;case'B':return 0x2;case'C':return 0x4;case'D':return 0x6;case'E':return 0x8;case'F':return 0xc;case'G':return 0x18;case'T':return 0xc;default:const q2=parseFloat(q1);return isNaN(q2)?0x0:q2;}},'IF':(IA,Ir,q0)=>IA?Ir:q0};function X(IA){if(IA instanceof Date)return IA;if(typeof IA!=='number'||isNaN(IA))return null;const Ir=new Date(Math['round']((IA-0x63e1)*0x15180*0x3e8));return new Date(Ir['getTime']()+Ir['getTimezoneOffset']()*0xea60);}function g(IA){if(!(IA instanceof Date)||isNaN(IA))return'';const Ir=IA['getFullYear']()['toString']()['slice'](-0x2),q0=String(IA['getMonth']()+0x1)['padStart'](0x2,'0'),q1=String(IA['getDate']())['padStart'](0x2,'0'),q2=String(IA['getHours']())['padStart'](0x2,'0'),q3=String(IA['getMinutes']())['padStart'](0x2,'0');return q1+'/'+q0+'/'+Ir+'\x20'+q2+':'+q3;}async function J(){try{const IA=await db['collection']('areas')['get'](),Ir=I('prodTarimas_area'),q0=Ir['value']||'';Ir['innerHTML']='<option\x20value=\x22\x22\x20disabled>Seleccione\x20치rea...</option><option\x20value=\x22ALL\x22>Todas\x20las\x20츼reas</option>';let q1=[];IA['forEach'](q2=>{q2['id']!=='CONFIG'&&q1['push'](q2['id']);}),q1['sort'](),q1['forEach'](q2=>{const q3=document['createElement']('option');q3['value']=q2,q3['textContent']=q2,Ir['appendChild'](q3);}),Ir['querySelector']('option[value=\x22'+q0+'\x22]')?Ir['value']=q0:Ir['value']='';}catch(q2){console['error']('[츼reas\x20Tarimas]\x20Error\x20cargando\x20치reas:',q2);const q3=I('prodTarimas_area');q3['innerHTML']='<option\x20value=\x22\x22\x20disabled\x20selected>Error\x20al\x20cargar</option>';}}function l(){const IA=new Date(),{shift:Ir,dateKey:q0}=I3(IA),{startTime:q1}=I5(q0,Ir),q2='MULTIPORT';I('liveTurnoTitle')['textContent']='Turno:\x20'+Ir+'\x20('+q2+')',r({},[],q1),V('liveDashboard');R&&(console['log']('Deteniendo\x20listener\x20anterior...'),R(),R=null);const q3=P['produccion_hora_config']['packers']||[],q4=q3['filter'](q7=>q7['turno']===Ir&&(q7['area']===q2||q7['area']==='ALL')),q5=new Map();q4['forEach'](q7=>{const q8=String(q7['linea']);!q5['has'](q8)&&q5['set'](q8,new Set()),q5['get'](q8)['add'](q7['id']);});const q6=new Date(q1);q6['setMinutes'](q6['getMinutes']()-0x1e),console['log']('游니\x20Listener\x20VIVO:\x20Buscando\x20cambios\x20desde\x20'+q6['toLocaleTimeString']()),R=db['collection']('areas')['doc'](q2)['collection']('orders')['where']('lastUpdated','>=',q6)['onSnapshot'](q7=>{console['log']('춰Datos\x20recibidos!\x20'+q7['size']+'\x20칩rdenes\x20activas\x20en\x20este\x20turno.');let q8=[];q7['forEach'](q9=>{q8['push'](q9['data']());}),A(q8,Ir,q0,q1,q5);},q7=>{console['error']('춰Error\x20en\x20el\x20listener\x20en\x20vivo!:',q7);if(q7['code']==='failed-precondition')I('liveFeedContent')['innerHTML']='<p\x20style=\x22color:var(--warning-color);\x22>丘멆잺\x20Falta\x20칈ndice.\x20Abre\x20consola\x20(F12).</p>';else{}});}function u(){R&&(console['log']('Deteniendo\x20listener\x20en\x20vivo...'),R(),R=null),F&&(F['destroy'](),F=null);}function A(IA,Ir,q0,q1,q2){let q3=[],q4={'timestamp':new Date(0x0),'empacador':'N/A','linea':'N/A'};const q5={},q6=Array(0xc)['fill'](0x0)['map'](()=>({})),q7=new Set();IA['forEach'](qf=>{const qn=qf['empaqueData']||[];if(!Array['isArray'](qn)){if(typeof qf['empaqueData']['forEach']==='function')qf['empaqueData']['forEach'](qB=>qn['push']({'serials':qB}));else{console['warn']('empaqueData\x20de\x20orden\x20'+qf['orderNumber']+'\x20no\x20es\x20un\x20array,\x20saltando.');return;}}qn['forEach'](qB=>{const qP=qB['serials'];Array['isArray'](qP)&&qP['forEach'](qw=>{const qo=X(qw['Finish\x20Packed\x20Date']);if(!qo)return;const {shift:qd,dateKey:qY}=I3(qo);if(qd===Ir&&qY===q0){const qe=(qw['Employee\x20ID']||'')['toString']()['toUpperCase']();let qp=null;for(const [qR,qF]of q2['entries']()){if(qF['has'](qe)){qp='L칤nea\x20'+qR;break;}}if(qp){q7['add'](qp);const qa=(qf['catalogNumber']||'')['substring'](0x3,0x4)['toUpperCase'](),qD=qa==='T'?0xc:parseInt(qa,0xa)||0x0;if(!q5[qp])q5[qp]={'term':0x0,'pzas':0x0};q5[qp]['term']+=qD,q5[qp]['pzas']++;const qV=qo-q1,qC=Math['floor'](qV/(0x3e8*0x3c*0x3c));if(qC>=0x0&&qC<0xc){if(!q6[qC][qp])q6[qC][qp]=0x0;q6[qC][qp]+=qD;}qo>q4['timestamp']&&(q4={'timestamp':qo,'empacador':qe,'linea':qp});}}});});});const q8=[...q7]['sort'](),q9=I('liveChartLastScan');q4['timestamp']>0x0?q9['innerHTML']='칔ltimo\x20escaneo:\x20'+q4['timestamp']['toLocaleTimeString']('es-ES',{'hour':'2-digit','minute':'2-digit'})+'\x20('+q4['linea']+')':q9['innerHTML']='Esperando\x20escaneo...';const qI=0x14a0,qq=I('kpiCardContainer');let qQ='';q8['forEach'](qf=>{const qn=qf['split']('\x20')[0x1],qB=q5[qf]&&q5[qf]['term']?q5[qf]['term']:0x0,qP=q5[qf]&&q5[qf]['pzas']?q5[qf]['pzas']:0x0,qw=qB/qI*0x64;let qo='progress-bar-red';if(qw>=0x50)qo='progress-bar-green';else{if(qw>=0x28)qo='progress-bar-yellow';}qQ+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22kpi-card\x22\x20id=\x22kpi-linea-'+qn+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22kpi-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>'+qf+'</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22kpi-linea-'+qn+'-meta\x22\x20class=\x22kpi-meta\x22>Meta:\x20'+qI['toLocaleString']()+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1\x20id=\x22kpi-linea-'+qn+'-total\x22>'+qB['toLocaleString']()+'</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20id=\x22kpi-linea-'+qn+'-piezas\x22\x20class=\x22kpi-piezas\x22>'+qP['toLocaleString']()+'\x20Piezas</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22kpi-progress-bar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22kpi-linea-'+qn+'-progress\x22\x20class=\x22kpi-progress-bar\x20'+qo+'\x22\x20style=\x22width:\x20'+Math['min'](qw,0x64)+'%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22kpi-linea-'+qn+'-percent\x22\x20class=\x22kpi-percent\x22>'+qw['toFixed'](0x1)+'%</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}),q8['length']===0x0?qq['innerHTML']='<p\x20style=\x22color:\x20var(--text-secondary);\x20text-align:\x20center;\x20width:\x20100%;\x20grid-column:\x201\x20/\x20-1;\x22>Esperando\x20datos\x20de\x20producci칩n\x20para\x20las\x20l칤neas...</p>':qq['innerHTML']=qQ,r(q6,q8,q1);}function r(IA,Ir,q0){const q1=I('liveProduccionChart');if(!q1)return;const q2=q1['getContext']('2d');if(!q2)return;const q3=Array(0xc)['fill'](0x1e0);q3[0x1]=0x168,q3[0x5]=0x118,q3[0x8]=0x168;const q4=Array(0xc)['fill'](0x1e0);F&&(F['destroy'](),F=null);q2['clearRect'](0x0,0x0,q1['width'],q1['height']);const q5=[],q6=q0 instanceof Date?q0:new Date(q0);if(isNaN(q6['getTime']())){console['error']('Error\x20Cr칤tico:\x20La\x20fecha\x20de\x20inicio\x20(startTime)\x20es\x20inv치lida.',q0);for(let qI=0x0;qI<0xc;qI++)q5['push']('Error\x20Fecha');}else for(let qq=0x0;qq<0xc;qq++){const qQ=new Date(q6['getTime']());qQ['setHours'](qQ['getHours']()+qq);const qf=new Date(qQ['getTime']());qf['setHours'](qf['getHours']()+0x1);const qn={'hour':'2-digit','minute':'2-digit','hour12':![]};q5['push'](qQ['toLocaleTimeString']([],qn)+'\x20-\x20'+qf['toLocaleTimeString']([],qn));}const q7=['rgba(54,\x20162,\x20235,\x200.6)','rgba(255,\x2099,\x20132,\x200.6)','rgba(75,\x20192,\x20192,\x200.6)','rgba(255,\x20206,\x2086,\x200.6)','rgba(153,\x20102,\x20255,\x200.6)'],q8=['rgba(54,\x20162,\x20235,\x201)','rgba(255,\x2099,\x20132,\x201)','rgba(75,\x20192,\x20192,\x201)','rgba(255,\x20206,\x2086,\x201)','rgba(153,\x20102,\x20255,\x201)'],q9=Ir['map']((qB,qP)=>{return{'label':qB,'data':q5['map']((qw,qo)=>IA[qo]&&IA[qo][qB]?IA[qo][qB]:0x0),'backgroundColor':q7[qP%q7['length']],'borderColor':q8[qP%q8['length']],'borderWidth':0x1,'order':0x1};});q9['unshift']({'type':'line','label':'Meta','data':q4,'borderColor':getComputedStyle(document['body'])['getPropertyValue']('--success-color'),'borderWidth':0x2,'borderDash':[0x5,0x5],'pointRadius':0x0,'fill':![],'order':0x0}),F=new Chart(q2,{'type':'bar','data':{'labels':q5,'datasets':q9},'options':{'responsive':!![],'maintainAspectRatio':![],'plugins':{'legend':{'position':'top','labels':{'color':'var(--text-primary)','filter':qB=>qB['datasetIndex']>0x0}},'title':{'display':!![],'text':'Producci칩n\x20por\x20Hora\x20(En\x20Vivo)','color':'var(--text-primary)','font':{'size':0x10}},'datalabels':{'display':qB=>qB['dataset']['type']!=='line','labels':{'value':{'anchor':'end','align':'top','offset':0x5,'backgroundColor':qB=>{const qP=qB['dataset']['data'][qB['dataIndex']]>=q3[qB['dataIndex']],qw=qP?'--glow-green':'--glow-red',qo=getComputedStyle(document['body'])['getPropertyValue'](qw)['trim']();return qo['replace'](/0.9\)$/,'0.4)');},'borderColor':qB=>{return qB['dataset']['data'][qB['dataIndex']]>=q3[qB['dataIndex']]?getComputedStyle(document['body'])['getPropertyValue']('--success-color'):getComputedStyle(document['body'])['getPropertyValue']('--danger-color');},'borderWidth':0x1,'borderRadius':0x4,'color':'white','font':{'weight':'bold'},'padding':{'top':0x2,'bottom':0x2,'left':0x5,'right':0x5},'formatter':qB=>qB>0x0?qB['toLocaleString']():''},'percentage':{'align':'center','anchor':'center','color':qB=>{const qP=qB['chart']['getDatasetMeta'](qB['datasetIndex'])['data'][qB['dataIndex']]['height'];return qP>0x12?'rgba(255,\x20255,\x20255,\x200.9)':'transparent';},'font':{'weight':'bold','size':0xb},'formatter':(qB,qP)=>{const qw=q3[qP['dataIndex']];if(qB<=0x0||qw===0x0)return'';const qo=qB/qw*0x64;return qo['toFixed'](0x0)+'%';},'textStrokeColor':'rgba(0,0,0,0.6)','textStrokeWidth':0x2}}}},'scales':{'x':{'grid':{'color':'var(--chart-grid-color)'},'ticks':{'color':'var(--chart-tick-color)','maxRotation':0x0,'minRotation':0x0,'autoSkip':!![],'font':{'size':0xa}},'categoryPercentage':0.7,'barPercentage':0.9},'y':{'beginAtZero':!![],'grid':{'color':'var(--chart-grid-color)','drawOnChartArea':![]},'ticks':{'color':'var(--chart-tick-color)'},'title':{'display':!![],'text':'Total\x20de\x20Terminaciones','color':'var(--chart-tick-color)'},'afterDataLimits':qB=>{qB['max']=qB['max']*1.2;}}}},'plugins':[ChartDataLabels]}),IB();}async function I0(IA){if(!IA||IA['length']===0x0)return;W('Procesando...','<p>Cargando\x20'+IA['length']+'\x20archivo(s).\x20Por\x20favor,\x20espere...</p>');const Ir=q0=>{return new Promise((q1,q2)=>{const q3=new FileReader();q3['onload']=q4=>{try{const q5=XLSX['read'](new Uint8Array(q4['target']['result']),{'type':'array'}),q6=q5['Sheets'][q5['SheetNames'][0x0]],q7=0x1,q8=XLSX['utils']['sheet_to_json'](q6,{'header':0x1,'range':q7}),q9=q8['map'](qI=>({'boxId':qI[0x9],'gr':qI[0x0],'receivedDate':qI[0x6]}))['filter'](qI=>qI['boxId']!==undefined&&qI['boxId']!==null&&String(qI['boxId'])['trim']()!=='');q1(q9);}catch(qI){console['error']('Error\x20procesando\x20el\x20archivo\x20'+q0['name']+':',qI),q2('No\x20se\x20pudo\x20leer\x20el\x20archivo\x20'+q0['name']+'.');}},q3['onerror']=()=>q2('Error\x20al\x20leer\x20el\x20archivo\x20'+q0['name']+'.'),q3['readAsArrayBuffer'](q0);});};try{const q0=await Promise['all'](Array['from'](IA)['map'](Ir)),q1=q0['flat']();if(q1['length']===0x0){W('Sin\x20Datos','<p>No\x20se\x20encontraron\x20BoxIDs\x20v치lidos\x20en\x20la\x20columna\x20J\x20de\x20los\x20archivos\x20seleccionados.</p>');return;}const q2=db['batch'](),q3=new Map();q1['forEach'](q4=>{q3['set'](String(q4['boxId'])['trim'](),q4);}),q3['forEach']((q4,q5)=>{const q6=db['collection']('boxID_historico')['doc'](q5),q7=q4['receivedDate']?X(q4['receivedDate']):new Date(),q8={'gr':q4['gr']||'N/A','receivedAt':q7};q2['set'](q6,q8,{'merge':!![]});}),await q2['commit'](),I('fileDropAreaBoxID')['style']['borderColor']='var(--success-color)',W('칄xito','<p>Proceso\x20completado.\x20Se\x20han\x20guardado/actualizado\x20<strong>'+q3['size']+'</strong>\x20registros\x20칰nicos\x20de\x20<strong>'+IA['length']+'</strong>\x20archivo(s).</p>');}catch(q4){console['error']('Error\x20en\x20el\x20procesamiento\x20de\x20m칰ltiples\x20archivos:',q4),I('fileDropAreaBoxID')['style']['borderColor']='var(--danger-color)',W('Error\x20de\x20Archivo','<p>'+q4+'</p>');}}async function I1(IA){if(!IA||IA['length']===0x0)return;W('Procesando...','<p>Cargando\x20'+IA['length']+'\x20archivo(s)\x20de\x20usuarios...</p>');const Ir=q0=>{return new Promise((q1,q2)=>{const q3=new FileReader();q3['onload']=q4=>{try{const q5=XLSX['read'](new Uint8Array(q4['target']['result']),{'type':'array'}),q6=q5['Sheets'][q5['SheetNames'][0x0]],q7=XLSX['utils']['sheet_to_json'](q6,{'header':0x1,'range':0x1}),q8=q7['map'](q9=>({'gr':q9[0x1],'orden':q9[0x5],'usuario':q9[0x8]}))['filter'](q9=>q9['gr']&&String(q9['gr'])['trim']()!=='');q1(q8);}catch(q9){q2('Error\x20al\x20leer\x20'+q0['name']+'.');}},q3['readAsArrayBuffer'](q0);});};try{const q0=await Promise['all'](Array['from'](IA)['map'](Ir)),q1=q0['flat']();if(q1['length']===0x0){W('Sin\x20Datos','<p>No\x20se\x20encontr칩\x20informaci칩n\x20de\x20GR\x20v치lida\x20en\x20los\x20archivos\x20seleccionados.</p>');return;}const q2=db['batch'](),q3=new Map();q1['forEach'](q4=>{q3['set'](String(q4['gr'])['trim'](),{'usuario':q4['usuario']||'N/A','orden':q4['orden']||'N/A'});}),q3['forEach']((q4,q5)=>{const q6=db['collection']('gr_historico')['doc'](q5);q2['set'](q6,q4,{'merge':!![]});}),await q2['commit'](),I('fileDropAreaGrUsuarios')['style']['borderColor']='var(--success-color)',W('칄xito','<p>Proceso\x20completado.\x20Se\x20han\x20guardado\x20<strong>'+q3['size']+'</strong>\x20registros\x20de\x20GR\x20칰nicos.</p>');}catch(q4){console['error']('Error\x20en\x20el\x20procesamiento\x20de\x20archivos\x20GR\x20Usuarios:',q4),I('fileDropAreaGrUsuarios')['style']['borderColor']='var(--danger-color)',W('Error','<p>'+(q4['message']||q4)+'</p>');}}function I2(IA,Ir){const q0=I('produccionSemanalChart')['getContext']('2d');p&&p['destroy']();const q1=0x14a0;p=new Chart(q0,{'type':'bar','data':{'labels':Ir['map'](q2=>new Date(q2+'T00:00:00')['toLocaleDateString']('es-MX',{'weekday':'short','month':'short','day':'numeric'})),'datasets':[{'label':'L칤nea\x201','data':Ir['map'](q2=>IA[q2]['L칤nea\x201']['term']),'backgroundColor':'rgba(245,\x20158,\x2011,\x200.8)'},{'label':'L칤nea\x202','data':Ir['map'](q2=>IA[q2]['L칤nea\x202']['term']),'backgroundColor':'rgba(16,\x20185,\x20129,\x200.8)'},{'type':'line','label':'Meta','data':Array(Ir['length'])['fill'](q1),'borderColor':'var(--success-color)','borderWidth':0x2,'pointRadius':0x0,'fill':![],'datalabels':{'display':![]}}]},'options':{'responsive':!![],'maintainAspectRatio':![],'scales':{'y':{'beginAtZero':!![],'ticks':{'color':'var(--chart-tick-color)'},'grid':{'color':'var(--chart-grid-color)'}},'x':{'ticks':{'color':'var(--chart-tick-color)'},'grid':{'color':'var(--chart-grid-color)'}}},'plugins':{'legend':{'position':'top','labels':{'color':'var(--text-primary)'}},'datalabels':{'display':q2=>q2['dataset']['type']!=='line','labels':{'terminaciones':{'anchor':'end','align':'top','formatter':q2=>q2>0x0?q2['toLocaleString']('es-MX'):'','color':'var(--text-primary)','font':{'weight':'bold'}},'eficiencia':{'anchor':'center','align':'center','formatter':(q2,q3)=>{if(q3['dataset']['type']==='line'||q2===0x0)return'';const q4=(q2/q1*0x64)['toFixed'](0x0)+'%';return q4;},'color':q2=>{const q3=document['body']['classList']['contains']('light-theme'),q4=q2['chart']['getDatasetMeta'](q2['datasetIndex'])['data'][q2['dataIndex']]['height'];if(q4<0x14)return'transparent';return q3?'#111827':'rgba(255,\x20255,\x20255,\x200.9)';},'font':{'weight':'bold','size':0xe},'textStrokeColor':q2=>{const q3=document['body']['classList']['contains']('light-theme');return q3?'rgba(255,255,255,0.6)':'rgba(0,0,0,0.6)';},'textStrokeWidth':0x2}}}}},'plugins':[ChartDataLabels]}),IB();}function I3(IA){const Ir=IA['getHours'](),q0=IA['getMinutes']();let q1=new Date(IA['getTime']());(Ir<0x6||Ir===0x6&&q0<0x1e)&&q1['setDate'](q1['getDate']()-0x1);const q2=q1['getFullYear'](),q3=String(q1['getMonth']()+0x1)['padStart'](0x2,'0'),q4=String(q1['getDate']())['padStart'](0x2,'0'),q5=q2+'-'+q3+'-'+q4,q6=new Date('2025-10-06T00:00:00'),q7=q1['getTime']()-q6['getTime'](),q8=Math['floor'](q7/(0x3e8*0x3c*0x3c*0x18*0x7)),q9=q8%0x2===0x0,qI=q1['getDay'](),qq=(Ir>0x6||Ir===0x6&&q0>=0x1e)&&(Ir<0x12||Ir===0x12&&q0<0x1e);let qQ;return q9?qI>=0x1&&qI<=0x3?qQ=qq?'T45':'T46':qQ=qq?'T47':'T48':qI>=0x1&&qI<=0x4?qQ=qq?'T45':'T46':qQ=qq?'T47':'T48',{'shift':qQ,'dateKey':q5};}function I4(){const IA=new Date(),Ir=new Date('2025-10-06T00:00:00'),q0=IA['getTime']()-Ir['getTime'](),q1=Math['floor'](q0/(0x3e8*0x3c*0x3c*0x18*0x7)),q2=q1%0x2===0x0;let q3=IA['getDay']();const q4=IA['getHours'](),q5=IA['getMinutes']();(q4<0x6||q4===0x6&&q5<0x1e)&&(q3=q3===0x0?0x6:q3-0x1);const q6=q4>=0x6&&(q4<0x12||q4===0x12&&q5<0x1e);return q2?q3>=0x1&&q3<=0x3?q6?'T45':'T46':q6?'T47':'T48':q3>=0x1&&q3<=0x4?q6?'T45':'T46':q6?'T47':'T48';}function I5(IA,Ir){const q0=new Date(IA+'T00:00:00');let q1,q2;switch(Ir){case'T45':case'T47':q1=new Date(q0['getTime']()),q1['setHours'](0x6,0x1e,0x0,0x0),q2=new Date(q0['getTime']()),q2['setHours'](0x12,0x1d,0x3b,0x3e7);break;case'T46':case'T48':q1=new Date(q0['getTime']()),q1['setHours'](0x12,0x1e,0x0,0x0),q2=new Date(q0['getTime']()),q2['setDate'](q2['getDate']()+0x1),q2['setHours'](0x6,0x1d,0x3b,0x3e7);break;}return{'startTime':q1,'endTime':q2};}I('generarReporteProduccionBtn')['addEventListener']('click',I8),I('exportChartBtn')['addEventListener']('click',Iw),I('exportarSemanalBtn')['addEventListener']('click',Io);function I6(){I('chartContainer')['style']['display']='none',I('fibraReportContainer')['style']['display']='none',I('semanalContainer')['style']['display']='none',I('produccionTablesGrid')['style']['display']='none';}I('showProduccionHoraBtn')['addEventListener']('click',()=>{I6(),I('fechaUnicaContainer')['style']['display']='block',I('fechaRangoContainer')['style']['display']='none',I('chartContainer')['style']['display']='flex',I('produccionTablesGrid')['style']['display']='grid',I('generarReporteProduccionBtn')['textContent']='Generar\x20Reporte\x20por\x20Hora';}),I('showProduccionFibraBtn')['addEventListener']('click',()=>{if(!e){W('Datos\x20no\x20disponibles','<p>Primero\x20debe\x20generar\x20un\x20reporte\x20de\x20producci칩n\x20por\x20hora.</p>');return;}I6(),I('fechaUnicaContainer')['style']['display']='block',I('fechaRangoContainer')['style']['display']='none',In(e),I('fibraReportContainer')['style']['display']='flex',I('generarReporteProduccionBtn')['textContent']='Generar\x20Reporte\x20por\x20Hora';}),I('showProduccionSemanaBtn')['addEventListener']('click',()=>{I6(),I('fechaUnicaContainer')['style']['display']='none',I('fechaRangoContainer')['style']['display']='block',I('semanalContainer')['style']['display']='flex',I('generarReporteProduccionBtn')['textContent']='Generar\x20Reporte\x20Semanal';if(p)p['destroy']();I('resumenSemanal')['innerHTML']='<h4\x20style=\x22text-align:center;\x22>Configure\x20filtros\x20y\x20presione\x20\x22Generar\x20Reporte\x22.</h4>';});async function I7(){try{const IA=await db['collection']('areas')['get'](),Ir=I('prod_area'),q0=Ir['value'],q1=new Set(Array['from'](Ir['options'])['map'](q3=>q3['value']));let q2=[];IA['forEach'](q3=>{if(q3['id']!=='CONFIG')q2['push'](q3['id']);}),q2['sort'](),q2['forEach'](q3=>{if(!q1['has'](q3)){const q4=document['createElement']('option');q4['value']=q3,q4['textContent']=q3,Ir['appendChild'](q4);}}),Ir['value']=q0;}catch(q3){console['error']('Error\x20cargando\x20치reas:',q3);}}async function I8(){I('semanalContainer')['style']['display']==='flex'?await II():await I9();}async function I9(){const IA=I('generarReporteProduccionBtn');IA['disabled']=!![],IA['textContent']='Analizando\x20actividad\x20reciente...',I('exportChartBtn')['style']['display']='none';const Ir=I('produccionTablesGrid');Ir['innerHTML']='';try{const q0=I('prod_fecha_unica')['value'],q1=I('prod_turno')['value'],q2=I('prod_area')['value'];if(!q0){W('Error','<p>Por\x20favor,\x20selecciona\x20una\x20fecha.</p>');return;}const {startTime:q3,endTime:q4}=I5(q0,q1),q5=P['produccion_hora_config']['packers']||[],q6=q5['filter'](qo=>(qo['area']===q2||q2==='ALL'||qo['area']==='ALL')&&qo['turno']===q1);if(q6['length']===0x0){W('Sin\x20Empacadores','<p>No\x20hay\x20empacadores\x20configurados\x20para\x20este\x20turno/치rea.</p>'),If([],null,q1);return;}const q7=new Map();q6['forEach'](qo=>{const qd=String(qo['linea']);if(!q7['has'](qd))q7['set'](qd,new Set());q7['get'](qd)['add'](qo['id']);});const q8=new Date(q3);q8['setHours'](q8['getHours']()-0x1),console['log']('[Producci칩n]\x20Consultando\x20cambios\x20desde:\x20'+q8['toLocaleString']());let q9=q2==='ALL'?db['collectionGroup']('orders'):db['collection']('areas')['doc'](q2)['collection']('orders');q9=q9['where']('lastUpdated','>=',q8);const qI=await q9['get']();console['log']('[Producci칩n]\x20Descargadas:\x20'+qI['size']+'\x20칩rdenes\x20(potencialmente\x20activas).');let qq=[],qQ=0x0;!qI['empty']&&qI['forEach'](qo=>{const qd=qo['data']();let qY=![];Array['isArray'](qd['empaqueData'])&&qd['empaqueData']['forEach'](qe=>{Array['isArray'](qe['serials'])&&qe['serials']['forEach'](qp=>{const qR=X(qp['Finish\x20Packed\x20Date']);if(qR&&qR>=q3&&qR<=q4){const qF=(qp['Employee\x20ID']||'')['toString']()['toUpperCase']();let qa=null;for(const [qD,qV]of q7['entries']()){if(qV['has'](qF)){qa=qD;break;}}qa&&(qY=!![],qq['push']({'orden':qo['id'],'catalogo':qd['catalogNumber']||'N/A','empacador':qF,'timestamp':qR,'linea':'L칤nea\x20'+qa,'boxId':qe['boxId']||'SIN_CAJA'}));}});});if(qY)qQ++;});console['log']('[Producci칩n]\x20De\x20las\x20'+qI['size']+'\x20descargadas,\x20solo\x20'+qQ+'\x20ten칤an\x20datos\x20reales\x20para\x20este\x20turno.');const qf=qq['map'](qo=>{const qd=(qo['catalogo']||'')['substring'](0x3,0x4)['toUpperCase'](),qY=qd==='T'?0xc:parseInt(qd,0xa)||0x0;return{...qo,'fibras':qY,'terminaciones':qY};});e=qf;const qn=new Map();qf['forEach'](qo=>{const qd=qo['orden']+'-'+qo['boxId'];if(!qn['has'](qd))qn['set'](qd,{...qo,'piezas':0x0,'terminaciones':0x0});const qY=qn['get'](qd);qY['piezas']++,qY['terminaciones']+=qo['terminaciones'];if(qo['timestamp']>qY['timestamp'])qY['timestamp']=qo['timestamp'];});const qB=Array['from'](qn['values']())['sort']((qo,qd)=>qd['timestamp']-qo['timestamp']),qP=new Map();qB['forEach'](qo=>{const qd=qo['linea'];if(!qd)return;if(!qP['has'](qd))qP['set'](qd,[]);qP['get'](qd)['push'](qo);});const qw=[...qP['keys']()]['sort']();if(qw['length']===0x0){W('Sin\x20Producci칩n','<p>No\x20se\x20encontr칩\x20producci칩n\x20registrada\x20en\x20el\x20periodo\x20seleccionado.</p>'),Ir['innerHTML']='',If([],q3,q1),e=[];return;}Ir['style']['gridTemplateColumns']='repeat('+qw['length']+',\x201fr)',qw['forEach'](qo=>{const qd=qo['split']('\x20')[0x1],qY='dataTableProduccionL'+qd;Ir['insertAdjacentHTML']('beforeend','<div\x20class=\x22card\x20table-container\x22><h5>Producci칩n\x20'+qo+'</h5><div\x20class=\x22table-wrapper\x22><table\x20id=\x22'+qY+'\x22><thead><tr><th>Cargando...</th></tr></thead><tbody></tbody></table></div></div>');});for(const [qo,qd]of qP['entries']()){const qY=qo['split']('\x20')[0x1];IQ(qd,'dataTableProduccionL'+qY,qo);}If(qf,q3,q1);}catch(qe){console['error']('Error\x20report\x20hourly:',qe),qe['code']==='failed-precondition'?W('Falta\x20칈ndice','<p>Firebase\x20requiere\x20un\x20칤ndice\x20para\x20esta\x20consulta\x20optimizada.\x20Abre\x20la\x20consola\x20(F12)\x20y\x20haz\x20clic\x20en\x20el\x20enlace.</p>','warning'):W('Error','<p>'+qe['message']+'</p>'),e=null;}finally{IA['disabled']=![],IA['textContent']='Generar\x20Reporte';}}async function II(){const IA=I('generarReporteProduccionBtn');IA['disabled']=!![],IA['textContent']='Procesando\x20semana...';try{const Ir=I('prod_fecha_inicio')['value'],q0=I('prod_fecha_fin')['value'],q1=I('prod_area')['value'],q2=I('prod_turno')['value'];if(!Ir||!q0){W('Error','<p>Faltan\x20fechas.</p>');return;}const q3=new Date(Ir+'T06:30:00');q3['setDate'](q3['getDate']()-0x1);const q4=new Date(q0+'T00:00:00');q4['setDate'](q4['getDate']()+0x1),q4['setHours'](0x6,0x1d,0x3b,0x3e7);let q5=q1==='ALL'?db['collectionGroup']('orders'):db['collection']('areas')['doc'](q1)['collection']('orders');const q6=new Date(q3);q6['setDate'](q6['getDate']()-0x1),q5=q5['where']('lastUpdated','>=',q6);const q7=await q5['get']();console['log']('[Semanal]\x20칍rdenes\x20activas\x20en\x20la\x20semana:\x20'+q7['size']);if(q7['empty']){W('Sin\x20Datos','<p>No\x20hubo\x20actividad\x20en\x20este\x20periodo.</p>'),I2({},[]),Iq({'L칤nea\x201':{'term':0x0,'pzas':0x0},'L칤nea\x202':{'term':0x0,'pzas':0x0}},0x0);return;}const q8=(P['produccion_hora_config']['packers']||[])['filter'](qn=>(qn['area']===q1||q1==='ALL')&&qn['turno']===q2),q9=q8['filter'](qn=>qn['linea']==='1')['map'](qn=>qn['id']),qI=q8['filter'](qn=>qn['linea']==='2')['map'](qn=>qn['id']);let qq={},qQ={'L칤nea\x201':{'term':0x0,'pzas':0x0},'L칤nea\x202':{'term':0x0,'pzas':0x0}};q7['forEach'](qn=>{const qB=qn['data']();Array['isArray'](qB['empaqueData'])&&qB['empaqueData']['forEach'](qP=>{Array['isArray'](qP['serials'])&&qP['serials']['forEach'](qw=>{const qo=X(qw['Finish\x20Packed\x20Date']);if(qo){const {shift:qd,dateKey:qY}=I3(qo),qe=q2===qd,qp=qY>=Ir&&qY<=q0;if(qe&&qp){const qR=(qw['Employee\x20ID']||'')['toString']()['toUpperCase']();let qF=null;if(q9['includes'](qR))qF='L칤nea\x201';else{if(qI['includes'](qR))qF='L칤nea\x202';}if(qF){const qa=(qB['catalogNumber']||'')['substring'](0x3,0x4)['toUpperCase'](),qD=qa==='T'?0xc:parseInt(qa,0xa)||0x0;!qq[qY]&&(qq[qY]={'L칤nea\x201':{'term':0x0,'pzas':0x0},'L칤nea\x202':{'term':0x0,'pzas':0x0}}),qq[qY][qF]['term']+=qD,qq[qY][qF]['pzas']++,qQ[qF]['term']+=qD,qQ[qF]['pzas']++;}}}});});});const qf=Object['keys'](qq)['sort']();I2(qq,qf),Iq(qQ,qf['length']);}catch(qn){console['error']('Error\x20semanal:',qn),qn['code']==='failed-precondition'?W('Falta\x20칈ndice','<p>Crea\x20el\x20칤ndice\x20en\x20Firebase\x20(ver\x20consola).</p>','warning'):W('Error','<p>'+qn['message']+'</p>');}finally{IA['disabled']=![],IA['textContent']='Generar\x20Reporte';}}function Iq(IA,Ir){const q0=I('resumenSemanal'),q1=0x14a0,q2=q1*Ir,q3=q2>0x0?IA['L칤nea\x201']['term']/q2*0x64:0x0,q4=q2>0x0?IA['L칤nea\x202']['term']/q2*0x64:0x0,q5=Math['min'](q3,0x64),q6=Math['min'](q4,0x64);q0['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22text-align:\x20center;\x20margin-top:\x200;\x22>Resumen\x20del\x20Periodo</h4>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background-color:\x20var(--surface-hover-color);\x20padding:\x2012px;\x20border-radius:\x208px;\x20margin-bottom:\x2016px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h5>Meta\x20Total\x20de\x20la\x20Semana</h5>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Terminaciones:</strong>\x20'+q2['toLocaleString']('es-MX')+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background-color:\x20var(--surface-hover-color);\x20padding:\x2012px;\x20border-radius:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h5>L칤nea\x201</h5>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Terminaciones:</strong>\x20'+IA['L칤nea\x201']['term']['toLocaleString']('es-MX')+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Eficiencia:</strong>\x20'+q3['toFixed'](0x1)+'%</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background-color:\x20var(--surface-hover-color);\x20padding:\x2012px;\x20border-radius:\x208px;\x20margin-top:\x2016px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h5>L칤nea\x202</h5>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Terminaciones:</strong>\x20'+IA['L칤nea\x202']['term']['toLocaleString']('es-MX')+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Eficiencia:</strong>\x20'+q4['toFixed'](0x1)+'%</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22summary-bars-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22summary-bar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22summary-bar\x22\x20style=\x22height:\x20'+q5+'%;\x20background-color:\x20rgba(245,\x20158,\x2011,\x200.8);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+q3['toFixed'](0x0)+'%</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22summary-bar-label\x22>L칤nea\x201</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22summary-bar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22summary-bar\x22\x20style=\x22height:\x20'+q6+'%;\x20background-color:\x20rgba(16,\x20185,\x20129,\x200.8);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+q4['toFixed'](0x0)+'%</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22summary-bar-label\x22>L칤nea\x202</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20';}function IQ(IA,Ir,q0){const q1=I(Ir);if(!IA||IA['length']===0x0){q1['innerHTML']='<thead><tr><th>Sin\x20registros\x20para\x20'+q0+'.</th></tr></thead><tbody></tbody>';return;}const q2=['Orden','Box\x20ID','Cat치logo','Piezas','Fecha/Hora','Term.'];let q3='<thead><tr>'+q2['map'](q4=>'<th>'+q4+'</th>')['join']('')+'</tr></thead><tbody>';IA['forEach'](q4=>{q3+='<tr><td>'+q4['orden']+'</td><td>'+q4['boxId']+'</td><td>'+q4['catalogo']+'</td><td>'+q4['piezas']+'</td><td>'+g(q4['timestamp'])+'</td><td>'+q4['terminaciones']+'</td></tr>';}),q1['innerHTML']=q3+'</tbody>';}function If(IA,Ir,q0){const q1=I('produccionChart');if(!q1){console['error']('renderProductionChart:\x20No\x20se\x20encontr칩\x20el\x20canvas\x20\x27produccionChart\x27.');return;}const q2=q1['getContext']('2d');d&&d['destroy']();q2['clearRect'](0x0,0x0,q1['width'],q1['height']);if(IA['length']===0x0){I('chartSummary')['innerHTML']='',I('exportChartBtn')['style']['display']='none';return;}const q3=Array(0xc)['fill'](0x1e0);q3[0x1]=0x168,q3[0x5]=0x118,q3[0x8]=0x168;const q4=Array(0xc)['fill'](0x1e0),q5={},q6=[],q7={},q8=new Set();for(let qn=0x0;qn<0xc;qn++){const qB=new Date(Ir);qB['setHours'](qB['getHours']()+qn);const qP=new Date(qB);qP['setHours'](qP['getHours']()+0x1);const qw={'hour':'2-digit','minute':'2-digit','hour12':![]};q6['push'](qB['toLocaleTimeString']('es-ES',qw)+'\x20-\x20'+qP['toLocaleTimeString']('es-ES',qw)),q5[qn]={};}IA['forEach'](qo=>{const qd=qo['linea'];if(!qd)return;q8['add'](qd);!q7[qd]&&(q7[qd]={'piezas':0x0,'terminaciones':0x0});const qY=Math['floor']((qo['timestamp']-Ir)/(0x3e8*0x3c*0x3c));qY>=0x0&&qY<0xc&&(!q5[qY][qd]&&(q5[qY][qd]=0x0),q5[qY][qd]+=qo['terminaciones']),q7[qd]['piezas']++,q7[qd]['terminaciones']+=qo['terminaciones'];});const q9=[...q8]['sort'](),qI=q9['map'](qo=>{const qd=q7[qo];return qo+':\x20<strong>'+qd['piezas']+'\x20pzas\x20/\x20'+qd['terminaciones']+'\x20term.</strong>';})['join']('\x20|\x20');I('chartSummary')['innerHTML']=qI;const qq=['rgba(54,\x20162,\x20235,\x200.6)','rgba(255,\x2099,\x20132,\x200.6)','rgba(75,\x20192,\x20192,\x200.6)','rgba(255,\x20206,\x2086,\x200.6)','rgba(153,\x20102,\x20255,\x200.6)'],qQ=['rgba(54,\x20162,\x20235,\x201)','rgba(255,\x2099,\x20132,\x201)','rgba(75,\x20192,\x20192,\x201)','rgba(255,\x20206,\x2086,\x201)','rgba(153,\x20102,\x20255,\x201)'],qf=q9['map']((qo,qd)=>{return{'label':qo,'data':Object['values'](q5)['map'](qY=>qY[qo]||0x0),'backgroundColor':qq[qd%qq['length']],'borderColor':qQ[qd%qQ['length']],'borderWidth':0x1,'order':0x1};});qf['unshift']({'type':'line','label':'Meta','data':q4,'borderColor':getComputedStyle(document['body'])['getPropertyValue']('--success-color'),'borderWidth':0x2,'borderDash':[0x5,0x5],'pointRadius':0x0,'fill':![],'order':0x0}),d=new Chart(q2,{'type':'bar','data':{'labels':q6,'datasets':qf},'options':{'responsive':!![],'maintainAspectRatio':![],'plugins':{'legend':{'position':'top','labels':{'color':'var(--text-primary)','filter':qo=>qo['datasetIndex']>0x0}},'title':{'display':!![],'text':'Producci칩n\x20de\x20Terminaciones\x20-\x20'+q0,'color':'var(--text-primary)','font':{'size':0x10}},'datalabels':{'display':qo=>qo['dataset']['type']!=='line','labels':{'value':{'anchor':'end','align':'top','offset':0x5,'backgroundColor':qo=>{const qd=qo['dataset']['data'][qo['dataIndex']]>=q3[qo['dataIndex']],qY=qd?'--glow-green':'--glow-red',qe=getComputedStyle(document['body'])['getPropertyValue'](qY)['trim']();return qe['replace'](/0.9\)$/,'0.4)');},'borderColor':qo=>{return qo['dataset']['data'][qo['dataIndex']]>=q3[qo['dataIndex']]?getComputedStyle(document['body'])['getPropertyValue']('--success-color'):getComputedStyle(document['body'])['getPropertyValue']('--danger-color');},'borderWidth':0x1,'borderRadius':0x4,'color':'white','font':{'weight':'bold'},'padding':{'top':0x2,'bottom':0x2,'left':0x5,'right':0x5},'formatter':qo=>qo>0x0?qo['toLocaleString']():''},'percentage':{'align':'center','anchor':'center','color':qo=>{const qd=qo['chart']['getDatasetMeta'](qo['datasetIndex'])['data'][qo['dataIndex']]['height'];return qd>0x12?'rgba(255,\x20255,\x20255,\x200.9)':'transparent';},'font':{'weight':'bold','size':0xb},'formatter':(qo,qd)=>{const qY=q3[qd['dataIndex']];if(qo<=0x0||qY===0x0)return'';const qe=qo/qY*0x64;return qe['toFixed'](0x0)+'%';},'textStrokeColor':'rgba(0,0,0,0.6)','textStrokeWidth':0x2}}}},'scales':{'x':{'grid':{'color':'var(--chart-grid-color)'},'ticks':{'color':'var(--chart-tick-color)','maxRotation':0x0,'minRotation':0x0,'autoSkip':!![],'font':{'size':0xa}},'categoryPercentage':0.7,'barPercentage':0.9},'y':{'beginAtZero':!![],'grid':{'color':'var(--chart-grid-color)'},'ticks':{'color':'var(--chart-tick-color)'},'title':{'display':!![],'text':'Total\x20de\x20Terminaciones','color':'var(--chart-tick-color)'},'afterDataLimits':qo=>{qo['max']=qo['max']*1.2;}}}},'plugins':[ChartDataLabels]}),I('exportChartBtn')['style']['display']='block',IB();}function In(IA){const Ir=I('fibraReportContent');Y['length']>0x0&&(Y['forEach'](q6=>q6['destroy']()),Y=[]);if(!IA||IA['length']===0x0){Ir['innerHTML']='<p>No\x20hay\x20datos\x20de\x20producci칩n\x20para\x20analizar.</p>';return;}const q0=new Map(),q1=new Set();IA['forEach'](q6=>{const q7=q6['linea'];if(!q7)return;q1['add'](q7),!q0['has'](q7)&&q0['set'](q7,[]),q0['get'](q7)['push'](q6);});const q2=(q6,q7,q8)=>{if(q6['length']===0x0)return'<div><h5>'+q7+'</h5><p>Sin\x20producci칩n\x20registrada.</p></div>';const q9={};q6['forEach'](qq=>{const qQ=qq['fibras']+'\x20Fibras',qf=qq['catalogo'];if(!q9[qQ])q9[qQ]={};if(!q9[qQ][qf])q9[qQ][qf]=0x0;q9[qQ][qf]++;});let qI='<div\x20class=\x22table-wrapper\x22\x20style=\x22max-height:\x20200px;\x22><table\x20class=\x22sub-table\x22><thead><tr><th>Fibra</th><th>Cat치logo</th><th>Piezas</th></tr></thead><tbody>';return Object['entries'](q9)['forEach'](([qq,qQ])=>{Object['entries'](qQ)['forEach'](([qf,qn])=>{qI+='<tr><td>'+qq+'</td><td>'+qf+'</td><td>'+qn+'</td></tr>';});}),qI+='</tbody></table></div>','<div><h5>'+q7+'</h5><div\x20class=\x22pie-chart-container\x22><canvas\x20id=\x22'+q8+'\x22></canvas></div>'+qI+'</div>';},q3=(q6,q7)=>{const q8=I(q6)?.['getContext']('2d');if(!q8||q7['length']===0x0)return null;const q9={};q7['forEach'](qQ=>{const qf=qQ['fibras']+'\x20Fibras';if(!q9[qf])q9[qf]=0x0;q9[qf]++;});const qI=Object['keys'](q9),qq=['#36A2EB','#FF6384','#FFCE56','#4BC0C0','#9966FF','#FF9F40'];return new Chart(q8,{'type':'pie','data':{'labels':qI,'datasets':[{'data':Object['values'](q9),'backgroundColor':qI['map']((qQ,qf)=>qq[qf%qq['length']])}]},'options':{'responsive':!![],'maintainAspectRatio':![],'plugins':{'legend':{'display':![]},'datalabels':{'formatter':(qQ,qf)=>{const qn=qf['chart']['data']['datasets'][0x0]['data']['reduce']((qB,qP)=>qB+qP,0x0);return(qQ*0x64/qn)['toFixed'](0x1)+'%';},'color':'#fff','textShadowColor':'rgba(0,0,0,0.7)','textShadowBlur':0x5,'font':{'weight':'bold'}}}},'plugins':[ChartDataLabels]});},q4=[...q1]['sort']();let q5='';q4['forEach']((q6,q7)=>{const q8='fibraPieChart'+q7,q9=q0['get'](q6)||[];q5+=q2(q9,q6,q8);}),Ir['innerHTML']='<div\x20class=\x22fibra-grid\x22\x20style=\x22grid-template-columns:\x20repeat('+q4['length']+',\x201fr);\x22>'+q5+'</div>',q4['forEach']((q6,q7)=>{const q8='fibraPieChart'+q7,q9=q0['get'](q6)||[],qI=q3(q8,q9);qI&&Y['push'](qI);}),IB();}function IB(){const IA=[d,p,F]['filter'](Boolean);if(IA['length']===0x0)return;const Ir=getComputedStyle(document['body'])['getPropertyValue']('--text-primary')['trim'](),q0=getComputedStyle(document['body'])['getPropertyValue']('--chart-tick-color')['trim'](),q1=getComputedStyle(document['body'])['getPropertyValue']('--chart-grid-color')['trim'](),q2=getComputedStyle(document['body'])['getPropertyValue']('--success-color')['trim']();IA['forEach'](q3=>{if(q3['options']['plugins']['legend'])q3['options']['plugins']['legend']['labels']['color']=Ir;if(q3['options']['plugins']['title'])q3['options']['plugins']['title']['color']=Ir;if(q3['config']['type']['includes']('bar')||q3['config']['type']['includes']('line')){if(q3['options']['plugins']['datalabels']){if(q3['options']['plugins']['datalabels']['labels']){if(q3['options']['plugins']['datalabels']['labels']['terminaciones'])q3['options']['plugins']['datalabels']['labels']['terminaciones']['color']=Ir;}else q3['options']['plugins']['datalabels']['color']!=='white'&&(q3['options']['plugins']['datalabels']['color']=Ir);}if(q3['data']['datasets']['some'](q4=>q4['type']==='line')){let q4=q3['data']['datasets']['find'](q5=>q5['type']==='line');if(q4)q4['borderColor']=q2;}q3['options']['scales']['x']&&(q3['options']['scales']['x']['ticks']['color']=q0,q3['options']['scales']['x']['grid']['color']=q1);q3['options']['scales']['y']&&(q3['options']['scales']['y']['ticks']['color']=q0,q3['options']['scales']['y']['grid']['color']=q1);if(q3['options']['scales']['y']['title'])q3['options']['scales']['y']['title']['color']=q0;}q3['update']();});}async function IP(){const IA=document['getElementById']('exportWrapper'),Ir=document['getElementById']('modalContent'),q0=document['getElementById']('exportarReporteCompletoBtn');if(!IA)return;q0['disabled']=!![];const q1=q0['innerHTML'];q0['innerHTML']='游닞',Ir['classList']['add']('export-mode-parent'),IA['classList']['add']('export-mode');graficaSemanalInstance&&graficaSemanalInstance['resize']();await new Promise(q4=>setTimeout(q4,0x320));const q2=document['body']['classList']['contains']('dark-theme'),q3=q2?'#1f2937':'#ffffff';try{const q4=window['scrollY'],q5=await html2canvas(IA,{'backgroundColor':q3,'scale':0x2,'useCORS':!![],'logging':![],'width':0x4b0,'windowWidth':0x4b0,'onclone':q9=>{const qI=q9['getElementById']('exportWrapper');qI['style']['display']='grid';}}),q6=document['createElement']('a');q6['href']=q5['toDataURL']('image/jpeg',0.9);const q7=document['getElementById']('semanal_fecha_inicio')['value'],q8=document['getElementById']('semanal_fecha_fin')['value'];q6['download']='Reporte_Semanal_Completo_'+q7+'_al_'+q8+'.jpg',q6['click']();}catch(q9){console['error']('Error\x20al\x20exportar\x20reporte\x20completo:',q9),alert('Hubo\x20un\x20error\x20al\x20generar\x20la\x20imagen.\x20Intenta\x20de\x20nuevo.');}finally{IA['classList']['remove']('export-mode'),Ir['classList']['remove']('export-mode-parent'),graficaSemanalInstance&&graficaSemanalInstance['resize'](),q0['disabled']=![],q0['innerHTML']=q1;}}function Iw(){const IA=I('chartContainer');if(!d||!IA){W('Error','<p>No\x20hay\x20una\x20gr치fica\x20para\x20exportar.</p>');return;}const Ir=I('exportChartBtn');Ir['style']['visibility']='hidden';const q0=document['body']['classList']['contains']('dark-theme')?'dark':'light',q1=q0==='dark'?'#2a2d32':'#f9fafb';html2canvas(IA,{'backgroundColor':q1,'scale':2.5,'useCORS':!![]})['then'](q2=>{const q3=document['createElement']('a');q3['href']=q2['toDataURL']('image/jpeg',0.95);const q4=I('prod_fecha_inicio')['value']||'fecha',q5=I('prod_turno')['value'];q3['download']='Reporte_Produccion_'+q5+'_'+q4+'.jpg',q3['click']();})['finally'](()=>{Ir['style']['visibility']='visible';});}function Io(){const IA=I('semanalContainer');if(!p||!IA){W('Error','<p>No\x20hay\x20una\x20gr치fica\x20semanal\x20para\x20exportar.\x20Genere\x20el\x20reporte\x20primero.</p>');return;}const Ir=I('exportarSemanalBtn');Ir['style']['visibility']='hidden';const q0=document['body']['classList']['contains']('dark-theme')?'dark':'light',q1=q0==='dark'?'#22252a':'#f9fafb';html2canvas(IA,{'backgroundColor':q1,'scale':0x2,'useCORS':!![]})['then'](q2=>{const q3=document['createElement']('a');q3['href']=q2['toDataURL']('image/jpeg',0.95);const q4=I('prod_fecha_inicio')['value'],q5=I('prod_fecha_fin')['value'];q3['download']='Reporte_Semanal_Produccion_'+q4+'_al_'+q5+'.jpg',q3['click']();})['finally'](()=>{Ir['style']['visibility']='visible';});}async function Id(){if(!o['zpptwc']||!o['coois'])return;const IA=P['terminaciones_config'],Ir='Orden';if(!IA['zpptwc_cols']['some'](q3=>q3['key']===Ir)||!IA['coois_cols']['some'](q3=>q3['key']===Ir)){W('Error\x20de\x20Configuraci칩n','<p>Aseg칰rese\x20de\x20mapear\x20una\x20columna\x20con\x20el\x20nombre\x20clave\x20\x22Orden\x22\x20en\x20ambos\x20reportes.</p>');return;}const q0=new Map(o['coois']['map'](q3=>[String(q3[Ir]||'')['replace'](/^0+/,''),q3])),q1=o['zpptwc']['map'](q3=>{const q4=String(q3[Ir]||'')['replace'](/^0+/,''),q5=q0['get'](q4)||{};let q6={...q3,...q5},q7={};for(const qf in q6){let qn=q6[qf];if(typeof qn==='string')qn=qn['trim']();if(qf==='Orden'||qf==='Material'||qf==='Operacion')q7[qf]=String(qn||'')['replace'](/^0+/,'');else qf==='Fecha'&&qn instanceof Date?q7[qf]=qn:q7[qf]=qn;}const q8=q7[IA['area_config']['source_col']],q9=IA['area_config']['mappings']['find'](qB=>String(qB['code'])['trim']()===String(q8)['trim']());q7['Area']=q9?q9['name']:'Desconocida',IA['final_cols']['filter'](qB=>qB['type']==='source')['forEach'](qB=>{q7[qB['key']]=q7[qB['value']];});const qI=IA['final_cols']['find'](qB=>qB['type']==='fibras_auto');if(qI){const qB=(q7['Area']||'')['trim']()['toUpperCase'](),qP=(q7['Catalogo']||'')['trim']()['toUpperCase']();let qw=0x0;const qo=IA['fiber_rules']&&IA['fiber_rules'][qB]?IA['fiber_rules'][qB]:IA['fiber_rules']?.['DEFAULT']||[],qd=qo['find'](qY=>qP['startsWith'](qY['prefix']||''));if(qd){if(parseInt(qd['length'])===0x0)qw=parseInt(qd['multiplier'])||0x0;else{const qY=(qd['start']||0x4)-0x1,qe=qP['substring'](qY,qY+0x1);if(qd['t_equals_12']&&qe==='T')qw=0xc;else{const qp=s['EXTRAER_FIBRAS'](qP,qd['start'],qd['length']),qR=qd['multiplier']||0x1;qw=qp*qR;}}}else{const qF=qP['substring'](0x3,0x4);if(qF==='T')qw=0xc;else{if(qF==='G')qw=0x18;else{const qa=parseInt(qF,0xa);qw=isNaN(qa)?0x0:qa;}}}q7[qI['key']]=qw;}const qq=IA['final_cols']['find'](qD=>qD['type']==='familia_auto');qq&&(q7[qq['key']]=s['EXTRAER'](q7['Catalogo'],0x1,0x3));const qQ=IA['final_cols']['find'](qD=>qD['type']==='terminaciones_auto');if(qQ){const qD=q7['Fibras']||0x0,qV=parseFloat(q7['Cantidad'])||0x0;q7[qQ['key']]=qD*qV;}if(q7['Terminaciones']!==undefined){let qC=parseFloat(q7['Terminaciones']);q7['Terminaciones']=isNaN(qC)||qC<0x0?0x0:qC;}return q7;}),q2=q1['map'](q3=>{const q4={...q3};return q4['Fecha']instanceof Date&&(q4['Fecha']=String(q4['Fecha']['getDate']())['padStart'](0x2,'0')+'/'+String(q4['Fecha']['getMonth']()+0x1)['padStart'](0x2,'0')+'/'+q4['Fecha']['getFullYear']()),q4;});Ip(q2),IF(q2),IY(q1);}async function IY(IA){if(!IA||IA['length']===0x0)return;W('Guardando\x20Hist칩rico...','<p>Subiendo\x20registros\x20a\x20la\x20base\x20de\x20datos\x20(Correcci칩n\x20de\x20duplicados\x20aplicada)...</p>');const Ir=0x1f4;let q0=[],q1=db['batch'](),q2=0x0;IA['forEach']((q3,q4)=>{if(q3['Orden']){let q5='NODATE';if(q3['Fecha']instanceof Date){const q9=q3['Fecha']['getFullYear'](),qI=String(q3['Fecha']['getMonth']()+0x1)['padStart'](0x2,'0'),qq=String(q3['Fecha']['getDate']())['padStart'](0x2,'0');q5=q9+'-'+qI+'-'+qq;}const q6=String(q3['Orden'])+'_'+q5+'_row'+q4,q7=db['collection']('terminaciones_historico')['doc'](q6),q8={...q3};q8['Fecha']instanceof Date&&(q8['Fecha']=firebase['firestore']['Timestamp']['fromDate'](q8['Fecha'])),q1['set'](q7,q8,{'merge':!![]}),q2++,q2>=Ir&&(q0['push'](q1['commit']()),q1=db['batch'](),q2=0x0);}});if(q2>0x0)q0['push'](q1['commit']());try{await Promise['all'](q0),W('칄xito','<p>Se\x20guardaron\x20<strong>'+IA['length']+'</strong>\x20registros\x20칰nicos\x20correctamente.</p>');}catch(q3){console['error']('Error\x20guardando:',q3),W('Error','<p>Hubo\x20un\x20problema\x20al\x20guardar\x20en\x20la\x20base\x20de\x20datos.</p>');}}async function Ie(){const IA=I('term_fecha_inicio')['value'],Ir=I('term_fecha_fin')['value'],q0=I('consultarTerminacionesHistoricoBtn');if(!IA||!Ir){alert('Por\x20favor\x20selecciona\x20un\x20rango\x20de\x20fechas.');return;}q0['disabled']=!![],q0['innerHTML']='Buscando...';const q1=new Date(IA+'T00:00:00'),q2=new Date(Ir+'T23:59:59');try{const q3=await db['collection']('terminaciones_historico')['where']('Fecha','>=',firebase['firestore']['Timestamp']['fromDate'](q1))['where']('Fecha','<=',firebase['firestore']['Timestamp']['fromDate'](q2))['get']();if(q3['empty'])Ip([]),IF([]),W('Sin\x20Resultados','<p>No\x20se\x20encontraron\x20registros\x20del\x20'+IA+'\x20al\x20'+Ir+'.</p>');else{const q4=[];q3['forEach'](q5=>{const q6=q5['data']();if(q6['Fecha']&&q6['Fecha']['toDate']){const q7=q6['Fecha']['toDate']();q6['Fecha']=String(q7['getDate']())['padStart'](0x2,'0')+'/'+String(q7['getMonth']()+0x1)['padStart'](0x2,'0')+'/'+q7['getFullYear']();}q4['push'](q6);}),Ip(q4),IF(q4);}}catch(q5){console['error']('Error\x20consulta:',q5),W('Error','<p>Error\x20al\x20consultar\x20la\x20base\x20de\x20datos.</p>');}finally{q0['disabled']=![],q0['innerHTML']='Consultar\x20Rango';}}function Ip(IA){const Ir=I('dataTableTerminaciones'),q0=P['terminaciones_config']['final_cols'];if(!q0||q0['length']===0x0){Ir['innerHTML']='<thead><tr><th>Configure\x20columnas</th></tr></thead><tbody></tbody>';return;}IA['sort']((q4,q5)=>{const q6=q1(q4['Fecha']),q7=q1(q5['Fecha']);return q7-q6;});function q1(q4){if(q4 instanceof Date)return q4;if(typeof q4==='string'){const q5=q4['split']('/');if(q5['length']===0x3)return new Date(q5[0x2],q5[0x1]-0x1,q5[0x0]);}return new Date(0x0);}const q2=q0['map'](q4=>q4['key']);let q3='<thead><tr>';q2['forEach'](q4=>{q3+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+q4+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22filter-input\x22\x20placeholder=\x22Buscar...\x22\x20data-column=\x22'+q4+'\x22\x20style=\x22width:100%;\x20margin-top:5px;\x20padding:4px;\x20box-sizing:border-box;\x20font-size:0.8em;\x20color:black;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</th>';}),q3+='</tr></thead><tbody>',IA['forEach'](q4=>{q3+='<tr>',q2['forEach'](q5=>{const q6=q4[q5]??'';q5['toUpperCase']()['includes']('GR')||q5['toUpperCase']()['includes']('ORDEN')?q3+='<td\x20class=\x22copyable\x22\x20onclick=\x22copyToClipboard(\x27'+String(q6)['replace'](/'/g,'\x5c\x27')+'\x27,\x20this)\x22\x20title=\x22Haz\x20clic\x20para\x20copiar\x22>'+q6+'</td>':q3+='<td>'+q6+'</td>';}),q3+='</tr>';}),Ir['innerHTML']=q3+'</tbody>',Ir['querySelectorAll']('.filter-input')['forEach'](q4=>{q4['addEventListener']('keyup',IR);});}function IR(){const IA=I('dataTableTerminaciones'),Ir=Array['from'](IA['querySelectorAll']('.filter-input')),q0=Ir['map']((q2,q3)=>({'index':q3,'value':q2['value']['toLowerCase']()['trim']()}))['filter'](q2=>q2['value']!==''),q1=IA['querySelectorAll']('tbody\x20tr');q1['forEach'](q2=>{let q3=!![];for(const q4 of q0){const q5=q2['children'][q4['index']];if(!q5)continue;const q6=q5['textContent']['toLowerCase']();if(!q6['includes'](q4['value'])){q3=![];break;}}q2['style']['display']=q3?'':'none';});}function IF(IA){const Ir=I('summaryContainer');if(!IA||IA['length']===0x0){Ir['innerHTML']='<div\x20class=\x22summary-header\x22><h3>Resumen\x20de\x20Terminaciones</h3></div><p>No\x20hay\x20datos\x20para\x20mostrar.</p>';return;}const q0={},q1=new Set();IA['forEach'](q8=>{const q9=q8['Area']||'Sin\x20츼rea',qI=q8['Fecha']||'Sin\x20Fecha',qq=q8['Terminaciones']||0x0;if(typeof qq==='number'&&qq>0x0){q1['add'](qI);if(!q0[q9])q0[q9]={};if(!q0[q9][qI])q0[q9][qI]=0x0;q0[q9][qI]+=qq;}});const q2=[...q1]['sort']((q8,q9)=>new Date(q8['split']('/')['reverse']()['join']('-'))-new Date(q9['split']('/')['reverse']()['join']('-')));let q3='<div\x20class=\x22summary-header\x22><h3>Resumen\x20de\x20Terminaciones</h3><button\x20id=\x22exportSummaryBtn\x22\x20class=\x22icon-btn\x22\x20title=\x22Exportar\x20como\x20JPG\x22><svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2222\x22\x20height=\x2222\x22\x20viewBox=\x220\x200\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M21\x2015v4a2\x202\x200\x200\x201-2\x202H5a2\x202\x200\x200\x201-2-2v-4\x22/><polyline\x20points=\x227\x2010\x2012\x2015\x2017\x2010\x22/><line\x20x1=\x2212\x22\x20y1=\x2215\x22\x20x2=\x2212\x22\x20y2=\x223\x22/></svg></button></div><div\x20id=\x22summaryTableWrapper\x22\x20class=\x22table-wrapper\x22><table><thead><tr><th>츼rea</th>';q2['forEach'](q8=>{q3+='<th>'+q8+'</th>';}),q3+='<th>Total\x20General</th></tr></thead><tbody>';let q4={};q2['forEach'](q8=>q4[q8]=0x0);let q5=0x0;const q6=Object['keys'](q0)['sort']();for(const q8 of q6){let q9=0x0;q3+='<tr><td>'+q8+'</td>',q2['forEach'](qI=>{const qq=q0[q8][qI]||0x0;q3+='<td>'+qq['toLocaleString']()+'</td>',q9+=qq,q4[qI]+=qq;}),q3+='<td\x20class=\x22grand-total\x22>'+q9['toLocaleString']()+'</td></tr>',q5+=q9;}q3+='<tr\x20class=\x22grand-total\x22><td>Total\x20General</td>',q2['forEach'](qI=>{q3+='<td>'+q4[qI]['toLocaleString']()+'</td>';}),q3+='<td>'+q5['toLocaleString']()+'</td></tr></tbody></table></div>',Ir['innerHTML']=q3;const q7=I('exportSummaryBtn');if(q7)q7['addEventListener']('click',ID);}window['copyToClipboard']=(IA,Ir)=>{if(!IA)return;const q0=Ir['textContent'],q1=Ir['style']['color'];navigator['clipboard']['writeText'](IA)['then'](()=>{Ia(Ir,q0,q1);})['catch'](q2=>{try{const q3=document['createElement']('textarea');q3['value']=IA,document['body']['appendChild'](q3),q3['select'](),document['execCommand']('copy'),document['body']['removeChild'](q3),Ia(Ir,q0,q1);}catch(q4){console['error'](q4);}});};function Ia(IA,Ir,q0){IA['textContent']='춰Copiado!',IA['style']['color']='var(--success-color)',setTimeout(()=>{IA['textContent']=Ir,IA['style']['color']=q0;},0x5dc);}function ID(){const IA=I('summaryContainer'),Ir=I('exportSummaryBtn');if(!IA||typeof html2canvas==='undefined')return;Ir['disabled']=!![],Ir['style']['visibility']='hidden';const q0=document['body']['classList']['contains']('dark-theme')?'dark':'light',q1=q0==='dark'?'#22252a':'#f9fafb';html2canvas(IA,{'backgroundColor':q1,'scale':0x2,'useCORS':!![],'onclone':q2=>{const q3=q2['getElementById']('summaryContainer'),q4=q3['querySelector']('.table-wrapper');q3['style']['padding']='16px',q4&&(q4['style']['overflow']='visible',q4['style']['width']='auto');}})['then'](q2=>{const q3=document['createElement']('a');q3['download']='Resumen_Terminaciones.jpg',q3['href']=q2['toDataURL']('image/jpeg',0.95),q3['click']();})['finally'](()=>{Ir['style']['visibility']='visible',Ir['disabled']=![];});}async function IV(IA){const Ir=P['901_config'];if(!Ir['columns']||Ir['columns']['length']===0x0){W('Error\x20de\x20Configuraci칩n','<p>Por\x20favor,\x20configure\x20el\x20mapeo\x20de\x20columnas\x20para\x20el\x20reporte\x20901.</p>');return;}const q0=Ir['columns']['find'](q4=>q4['key']['toLowerCase']()==='fecha'),q1=Ir['columns']['find'](q4=>q4['key']['toLowerCase']()==='usuario');if(!q0){W('Error\x20de\x20Configuraci칩n','<p>Debe\x20existir\x20una\x20columna\x20llamada\x20\x22Fecha\x22\x20en\x20el\x20mapeo.</p>');return;}if(Ir['userFilter']&&Ir['userFilter']['length']>0x0&&!q1){W('Error\x20de\x20Configuraci칩n','<p>Se\x20especificaron\x20filtros\x20de\x20usuario,\x20pero\x20no\x20hay\x20una\x20columna\x20mapeada\x20como\x20\x22Usuario\x22.</p>');return;}const q2=(Ir['userFilter']||[])['map'](q4=>q4['toUpperCase']()),q3=new FileReader();q3['onload']=async q4=>{try{const q5=XLSX['read'](new Uint8Array(q4['target']['result']),{'type':'array','cellDates':!![]}),q6=q5['Sheets'][q5['SheetNames'][0x0]],q7=XLSX['utils']['decode_range'](q6['!ref']),q8=[],q9=new Date();q9['setHours'](0x0,0x0,0x0,0x0);const qI=new Date(q9);qI['setDate'](qI['getDate']()-0x1);for(let qq=q7['s']['r']+0x1;qq<=q7['e']['r'];++qq){const qQ=q0['startCell']['match'](/[A-Z]+/)[0x0],qf=q6[qQ+(qq+0x1)];if(!qf||!qf['v'])continue;let qn=qf['t']==='n'?X(qf['v']):qf['v']instanceof Date?qf['v']:null;if(!qn)continue;qn['setHours'](0x0,0x0,0x0,0x0);const qB=qn['getTime']()===q9['getTime'](),qP=qn['getTime']()<q9['getTime']();let qw='';if(q1){const qd=q1['startCell']['match'](/[A-Z]+/)[0x0],qY=q6[qd+(qq+0x1)];qw=(qY?String(qY['v']):'')['toUpperCase']();}const qo=q2['length']===0x0||q2['includes'](qw);if(qP||qB&&qo){let qe={};Ir['columns']['forEach'](qp=>{const qR=qp['startCell']['trim']()['toUpperCase']();let qF;if(qR['includes'](',')){const qa=qR['split'](',')['map'](qV=>qV['trim']()['match'](/[A-Z]+/)[0x0]),qD=[];qa['forEach'](qV=>{const qC=q6[qV+(qq+0x1)],qS=qC?qC['w']||qC['v']:undefined;if(qS!==undefined&&qS!==null&&qS!==0x0&&String(qS)['trim']()!=='')qD['push'](qS);}),qF=qD['join']('\x20/\x20');}else{const qV=qR['match'](/[A-Z]+/)[0x0],qC=q6[qV+(qq+0x1)];qF=qC?qC['w']||qC['v']:undefined;}if(qp['key']['toLowerCase']()==='qty'&&qF!==undefined&&qF!==null){const qS=parseInt(qF,0xa);!isNaN(qS)&&(qF=qS);}qp['key']['toLowerCase']()['includes']('special\x20stock')&&((qF===0x0||qF==='0')&&(qF='')),qe[qp['key']]=qF;});if(qo){if(qB)qe['colorClass']='row-today';else{if(qn['getTime']()===qI['getTime']())qe['colorClass']='row-yesterday';else qe['colorClass']='row-past';}}q8['push'](qe);}}if(q8['length']===0x0){W('Sin\x20Coincidencias','<p>No\x20se\x20encontraron\x20registros\x20que\x20cumplan\x20con\x20los\x20filtros.</p>'),IC([]);return;}IC(q8),W('칄xito','<p>'+q8['length']+'\x20registros\x20han\x20sido\x20cargados.</p>');}catch(qp){console['error']('Error\x20al\x20procesar\x20archivo\x20901:',qp),W('Error\x20de\x20Archivo','<p>No\x20se\x20pudo\x20procesar\x20el\x20archivo.\x20Verifique\x20el\x20formato\x20y\x20la\x20configuraci칩n.</p>');}},q3['readAsArrayBuffer'](IA);}function IC(IA){const Ir=I('dataTable901'),q0=P['901_config']['columns'];if(!q0||!q0['length']){Ir['innerHTML']='<thead><tr><th>Por\x20favor,\x20configure\x20el\x20mapeo\x20de\x20columnas.</th></tr></thead><tbody></tbody>';return;}const q1=q0['map'](q3=>q3['key']);let q2='<thead><tr>';q1['forEach'](q3=>q2+='<th><span>'+q3+'</span><input\x20type=\x22text\x22\x20class=\x22filter-input\x22\x20placeholder=\x22Filtrar...\x22\x20data-column=\x22'+q3+'\x22></th>'),q2+='</tr></thead><tbody>',IA['forEach'](q3=>{q2+='<tr\x20class=\x22'+(q3['colorClass']||'')+'\x22>',q1['forEach'](q4=>{const q5=q3[q4]??'';if(q4['toUpperCase']()==='GR')q2+='<td\x20class=\x22copyable\x22\x20onclick=\x22copyToClipboard(\x27'+String(q5)['replace'](/'/g,'\x5c\x27')+'\x27,\x20this)\x22\x20title=\x22Haz\x20clic\x20para\x20copiar\x22>'+q5+'</td>';else q2+='<td>'+q5+'</td>';}),q2+='</tr>';}),Ir['innerHTML']=q2+'</tbody>',Ir['querySelectorAll']('.filter-input')['forEach'](q3=>{q3['addEventListener']('keyup',()=>IS());});}function IS(){const IA=I('dataTable901'),Ir=Array['from'](IA['querySelectorAll']('.filter-input'))['map'](q1=>({'columnIndex':Array['from'](q1['closest']('tr')['children'])['indexOf'](q1['closest']('th')),'value':q1['value']['toLowerCase']()})),q0=IA['querySelectorAll']('tbody\x20tr');q0['forEach'](q1=>{let q2=!![];Ir['forEach'](q3=>{if(q3['value']){const q4=q1['children'][q3['columnIndex']];if(!q4||!q4['textContent']['toLowerCase']()['includes'](q3['value']))q2=![];}}),q1['style']['display']=q2?'':'none';});}let Ij=null;async function IW(){if(Ij)return Ij;console['log']('游닌\x20Descargando\x20cat치logo\x20de\x20usuarios\x20y\x20치reas...');try{const IA=await db['collection']('users_tarimas')['get'](),Ir=new Map();return IA['forEach'](q0=>{const q1=q0['data']();q1['gafete']&&q1['area']&&Ir['set'](q1['gafete']['toUpperCase'](),q1['area']);}),Ij=Ir,Ir;}catch(q0){return console['error']('Error\x20cargando\x20usuarios:',q0),new Map();}}async function IK(){const IA=I('prodTarimas_fecha')['value'],Ir=I('prodTarimas_turno')['value'],q0=I('prodTarimas_area')['value'];if(!IA||!Ir||!q0){W('Datos\x20Requeridos','<p>Por\x20favor,\x20seleccione\x20fecha,\x20turno\x20y\x20치rea.</p>');return;}const q1=I('consultarTarimasBtn');q1&&(q1['disabled']=!![],q1['textContent']='Consultando...');const q2=I('tarimasTableContainer'),q3=I('dataTableTarimas');if(I('terminacionesDashboardContainer'))I('terminacionesDashboardContainer')['style']['display']='none';q2['style']['display']='flex',q3['innerHTML']='<thead><tr><th>Analizando\x20tarimas\x20y\x20cajas...</th></tr></thead><tbody></tbody>';try{const q4=await IW();let q5=db['collection']('tarimas_confirmadas');const {startTime:q6,endTime:q7}=I5(IA,Ir);q5=q5['where']('fecha','>=',q6)['where']('fecha','<=',q7);const q8=await q5['get']();if(q8['empty'])throw new Error('No\x20se\x20encontraron\x20tarimas\x20para\x20'+Ir+'\x20en\x20este\x20rango\x20de\x20fecha.');let q9=[],qI=new Set();const qq=IA['split']('-'),qQ=qq[0x0]+'-'+qq[0x1]+'-'+qq[0x2];q8['docs']['forEach'](qw=>{const qo=qw['data']();if(!qo['fecha']||!qo['cajas'])return;try{const qd=qo['fecha']['toDate'](),{shift:qY,dateKey:qe}=I3(qd);if(qe===qQ&&qY===Ir){const qp=(qo['gafete']||'')['toUpperCase']();let qR=qo['area']||q4['get'](qp)||'Indefinida';(q0==='ALL'||qR===q0)&&(q9['push']({'id':qw['id'],...qo,'areaCalculada':qR}),Array['isArray'](qo['cajas'])&&qo['cajas']['forEach'](qF=>{if(qF['codigoCaja'])qI['add'](String(qF['codigoCaja'])['trim']());}));}}catch(qF){console['error']('Error\x20procesando\x20tarima:',qF);}});if(q9['length']===0x0)throw new Error('Se\x20encontraron\x20datos,\x20pero\x20ninguno\x20coincide\x20con\x20el\x20츼rea\x20'+q0+'\x20o\x20el\x20turno\x20exacto.');const qf=new Map(),qn=Array['from'](qI),qB=async()=>{const qw=[];while(qn['length']){const qo=qn['splice'](0x0,0xa);if(qo['length']===0x0)break;const qd=db['collection']('boxID_historico')['where'](firebase['firestore']['FieldPath']['documentId'](),'in',qo)['get']()['then'](qY=>{qY['forEach'](qe=>{qf['set'](qe['id'],qe['data']());});});qw['push'](qd);}await Promise['all'](qw);};console['log']('[Tarimas]\x20Verificando\x20'+qI['size']+'\x20cajas\x20en\x20lotes\x20de\x2010...'),await qB();const qP=q9['map'](qw=>{const qo=qw['cajas']['map'](qa=>qa?.['codigoCaja']?String(qa['codigoCaja'])['trim']():null)['filter'](qa=>qa);let qd=0x0,qY=null;const qe=qw['cajas']['map'](qa=>{const qD=qa['codigoCaja']?String(qa['codigoCaja'])['trim']():null,qV=qa['numeroOrden']||'N/A';if(!qD)return{'bxid':'N/A','orden':qV,'gr':'N/A','receivedAt':null};const qC=qf['get'](qD);if(qC){qd++;const qS=qC['receivedAt']?qC['receivedAt']['toDate']():null;if(qS&&(!qY||qS>qY))qY=qS;return{'bxid':qD,'orden':qV,'gr':qC['gr']||'N/A','receivedAt':qS,'found':!![]};}else return{'bxid':qD,'orden':qV,'gr':'N/A','receivedAt':null,'found':![]};});let qp='status-rojo',qR='No\x20Recibida';const qF=qo['length'];if(qF>0x0){if(qd===qF)qp='status-verde',qR='Recibida\x20Completa';else qd>0x0&&(qp='status-naranja',qR='Recibida\x20Parcial');}else qw['cajas']['length']>0x0&&(qR='Sin\x20BXIDs');return{'folio':qw['folio'],'user':qw['gafete'],'area':qw['areaCalculada'],'totalCajas':qw['cajas']['length'],'statusClass':qp,'statusText':qR,'confirmationDate':qw['fecha']['toDate'](),'latestReceivedAt':qY,'bxidDetails':qe};});IH(qP);}catch(qw){console['error']('[Tarimas]\x20Error:',qw),qw['code']==='failed-precondition'?q3['innerHTML']='<thead><tr><th\x20style=\x27color:var(--warning-color);\x27>丘멆잺\x20Falta\x20칈ndice\x20en\x20Firebase</th></tr></thead><tbody><tr><td>Abre\x20la\x20consola\x20(F12)\x20y\x20haz\x20clic\x20en\x20el\x20link\x20para\x20crear\x20칤ndice\x20de\x20Fecha.</td></tr></tbody>':q3['innerHTML']='<thead><tr><th\x20style=\x27color:var(--danger-color);\x27>Error:\x20'+qw['message']+'</th></tr></thead>';}finally{q1&&(q1['disabled']=![],q1['textContent']='Consultar\x20Tarimas');}}function IH(IA){const Ir=I('dataTableTarimas');if(!Ir){console['error']('[Render\x20Tarimas]\x20Error:\x20Elemento\x20#dataTableTarimas\x20no\x20encontrado.');return;}if(!IA||IA['length']===0x0){Ir['innerHTML']='<thead><tr><th>No\x20se\x20encontraron\x20tarimas\x20para\x20esta\x20fecha\x20y\x20turno.</th></tr></thead><tbody></tbody>';return;}const q0=['Folio','Usuario','츼rea','Hora\x20Confirmaci칩n','Recibido\x20Log칤stica\x20(칔ltimo)','Estatus','Cajas','Detalles'];let q1='<thead><tr>';q0['forEach']((q3,q4)=>{let q5='padding:\x2012px\x2010px;\x20text-align:\x20left;\x20white-space:\x20nowrap;';['츼rea','Hora\x20Confirmaci칩n','Recibido\x20Log칤stica\x20(칔ltimo)','Estatus','Cajas','Detalles']['includes'](q3)&&(q5+='\x20text-align:\x20center;'),q1+='<th\x20style=\x22'+q5+'\x22><span>'+q3+'</span></th>';}),q1+='</tr></thead>';let q2='<tbody>';IA['sort']((q3,q4)=>(q3['folio']||'')['localeCompare'](q4['folio']||'')),IA['forEach']((q3,q4)=>{const q5=q3['confirmationDate']?q3['confirmationDate']['toLocaleTimeString']('es-ES',{'hour':'2-digit','minute':'2-digit','hour12':![]}):'N/A',q6=q3['latestReceivedAt']?g(q3['latestReceivedAt']):'Pendiente',q7='<button\x20class=\x22btn\x20btn-glass\x20btn-small\x20view-details-btn\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-index=\x22'+q4+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20aria-label=\x22Ver\x20detalles\x20de\x20tarima\x20'+q3['folio']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Ver\x20<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M1\x2012s4-8\x2011-8\x2011\x208\x2011\x208-4\x208-11\x208-11-8-11-8z\x22/><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x223\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>';q2+='<tr\x20style=\x22border-bottom:\x201px\x20solid\x20var(--border-color);\x22>',q2+='<td\x20style=\x22padding:\x2010px\x2010px;\x20font-weight:\x20bold;\x22>'+q3['folio']+'</td>',q2+='<td\x20style=\x22padding:\x2010px\x2010px;\x22>'+q3['user']+'</td>',q2+='<td\x20style=\x22padding:\x2010px\x2010px;\x20text-align:\x20center;\x22>'+q3['area']+'</td>',q2+='<td\x20style=\x22padding:\x2010px\x2010px;\x20text-align:\x20center;\x22>'+q5+'</td>',q2+='<td\x20style=\x22padding:\x2010px\x2010px;\x20text-align:\x20center;\x22>'+q6+'</td>',q2+='<td\x20style=\x22padding:\x2010px\x2010px;\x20text-align:\x20center;\x22><span\x20class=\x22status-dot\x20'+q3['statusClass']+'\x22></span>\x20'+q3['statusText']+'</td>',q2+='<td\x20style=\x22padding:\x2010px\x2010px;\x20text-align:\x20center;\x20font-weight:\x20bold;\x22>'+q3['totalCajas']+'</td>',q2+='<td\x20style=\x22padding:\x2010px\x2010px;\x20text-align:\x20center;\x22>'+q7+'</td>',q2+='</tr>';}),q2+='</tbody>',Ir['innerHTML']=q1+q2,Ir['querySelectorAll']('.view-details-btn')['forEach'](q3=>{q3['addEventListener']('click',q4=>{const q5=parseInt(q4['currentTarget']['dataset']['index'],0xa);if(IA&&IA[q5]){const q6=IA[q5];try{const q7=JSON['parse'](JSON['stringify'](q6['bxidDetails']));Im(q7,q6['statusText'],q6['folio']);}catch(q8){console['error']('Error\x20al\x20preparar\x20datos\x20para\x20el\x20modal:',q8),W('Error','<p>No\x20se\x20pudieron\x20cargar\x20los\x20detalles\x20(error\x20de\x20datos).</p>');}}else console['error']('[Render\x20Tarimas]\x20Datos\x20de\x20\x27pallets\x27\x20no\x20disponibles\x20para\x20el\x20칤ndice:',q5),W('Error','<p>No\x20se\x20pudieron\x20cargar\x20los\x20detalles\x20(datos\x20no\x20encontrados).</p>');});});}function Im(IA,Ir,q0){console['log']('[Modal\x20Detalle]\x20Abriendo\x20para\x20Folio:',q0,'\x20Estado:',Ir,'\x20Datos:',IA);if(!Array['isArray'](IA)){console['error']('[Modal\x20Detalle]\x20Error:\x20bxidDetails\x20no\x20es\x20un\x20array.'),W('Error\x20Interno','<p>Los\x20datos\x20de\x20las\x20cajas\x20son\x20inv치lidos.</p>');return;}try{const q1=IA['map'](q3=>{if(!q3)return console['warn']('[Modal\x20Detalle]\x20Se\x20encontr칩\x20un\x20elemento\x20\x27undefined\x27\x20en\x20bxidDetails.'),{'bxid':'Inv치lido','orden':'N/A','gr':'N/A','receivedAt':null};let q4=null;if(q3['receivedAt']){if(typeof q3['receivedAt']['toDate']==='function')q4=q3['receivedAt']['toDate']();else{if(typeof q3['receivedAt']==='string'){const q5=new Date(q3['receivedAt']);!isNaN(q5)?q4=q5:console['warn']('[Modal\x20Detalle]\x20No\x20se\x20pudo\x20convertir\x20string\x20a\x20fecha:\x20'+q3['receivedAt']);}else Object['prototype']['toString']['call'](q3['receivedAt'])==='[object\x20Date]'&&!isNaN(q3['receivedAt'])?q4=q3['receivedAt']:console['warn']('[Modal\x20Detalle]\x20Formato\x20de\x20fecha\x20no\x20reconocido\x20para\x20BXID\x20'+q3['bxid']+':',q3['receivedAt']);}}return{'bxid':q3['bxid']||'N/A','orden':q3['orden']||'N/A','gr':q3['gr']||'N/A','receivedAt':q4};});let q2='<p\x20style=\x22text-align:center;\x20font-size:0.9em;\x20color:\x20var(--text-secondary);\x22>Mostrando\x20'+q1['length']+'\x20cajas\x20para\x20Tarima:\x20<strong>'+q0+'</strong></p>';q2+='<ul\x20style=\x22list-style-type:\x20none;\x20padding:\x200;\x20max-height:\x2060vh;\x20overflow-y:\x20auto;\x22>',q1['forEach'](q3=>{const q4=q3['receivedAt']instanceof Date&&!isNaN(q3['receivedAt']),q5=Ir==='Recibida\x20Parcial'&&!q4,q6=q5?'missing-bxid':'',q7=q4?g(q3['receivedAt']):'Pendiente',q8=q4?'status-verde':'status-rojo';q2+='<li\x20class=\x22'+q6+'\x22\x20style=\x22margin-bottom:\x208px;\x20padding:\x208px;\x20border:\x201px\x20solid\x20var(--border-color);\x20border-radius:\x206px;\x20background-color:\x20var(--surface-color);\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22status-dot\x20'+q8+'\x22\x20style=\x22flex-shrink:\x200;\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22flex-grow:\x201;\x20font-size:\x200.9em;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong\x20style=\x22color:\x20var(--text-primary);\x22>BXID:</strong>\x20'+q3['bxid']+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Orden:</strong>\x20'+q3['orden']+'\x20|\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>GR:</strong>\x20'+q3['gr']+'\x20|\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>Recibido:</strong>\x20'+q7+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>';}),q2+='</ul>',W('Detalle\x20de\x20Cajas\x20-\x20Tarima\x20'+q0,q2);}catch(q3){console['error']('[Modal\x20Detalle]\x20Error\x20construyendo\x20modal:',q3),W('Error','<p>No\x20se\x20pudieron\x20mostrar\x20los\x20detalles\x20de\x20las\x20cajas.\x20Revisa\x20la\x20consola.</p>');}}async function Ih(){const IA=I('prodTarimas_fecha')['value'],Ir=I('prodTarimas_turno')['value'],q0=I('prodTarimas_area')['value'];if(!IA||!Ir||!q0){W('Datos\x20Requeridos','<p>Por\x20favor,\x20seleccione\x20fecha,\x20turno\x20y\x20치rea.</p>');return;}const q1=I('calcularTerminacionesDiaBtn');if(!q1)return;q1['disabled']=!![],q1['textContent']='Calculando...',IL['clear']();const q2=IA['split']('-'),q3=q2[0x2]+'/'+q2[0x1]+'/'+q2[0x0],q4=q2[0x0]+'-'+q2[0x1]+'-'+q2[0x2],q5=I('terminacionesDashboardContainer'),q6=I('tarimasTableContainer');if(q6)q6['style']['display']='none';if(!q5){console['error']('[TermConf]\x20Elemento\x20dashboard\x20no\x20encontrado.'),q1['disabled']=![],q1['textContent']='Calcular\x20Terminaciones\x20del\x20Turno';return;}q5['innerHTML']='<p\x20style=\x22text-align:center;\x22>Analizando\x20tarimas\x20y\x20consultando\x20칩rdenes...</p>',q5['style']['display']='block';let q7=0x0,q8=0x0,q9=0x0,qI=new Set(),qq=new Set(),qQ=0x0;const qf={};try{const qn=await IW();let qB=db['collection']('tarimas_confirmadas');const {startTime:qP,endTime:qw}=I5(IA,Ir);qB=qB['where']('fecha','>=',qP)['where']('fecha','<=',qw);const qo=await qB['get']();if(qo['empty'])throw new Error('No\x20se\x20encontraron\x20tarimas\x20confirmadas\x20para\x20el\x20turno\x20'+Ir+'\x20en\x20la\x20fecha\x20'+q3+'.');let qd=[];qo['docs']['forEach'](qY=>{const qe=qY['data']();if(!qe||!qe['fecha']||!qe['cajas'])return;try{const qp=qe['fecha']['toDate'](),{shift:qR,dateKey:qF}=I3(qp);if(qF===q4&&qR===Ir){const qa=(qe['gafete']||'')['toUpperCase'](),qD=qe['area']||qn['get'](qa)||'Indefinida';(q0==='ALL'||qD===q0)&&qd['push']({'folio':qe['folio'],'cajas':qe['cajas'],'area':qD});}}catch(qV){console['error']('Error\x20procesando\x20data\x20de\x20tarima:',qV);}});if(qd['length']===0x0)throw new Error('Se\x20encontraron\x20tarimas,\x20pero\x20ninguna\x20coincide\x20con\x20el\x20츼rea\x20'+q0+'\x20(seg칰n\x20el\x20usuario\x20que\x20la\x20cre칩).');q8=qd['length'],console['log']('[TermConf]\x20'+q8+'\x20tarimas\x20v치lidas\x20para\x20procesar.');for(const qY of qd){const qe=qY['area'];for(const qp of qY['cajas']){q9++;const qR=qp['numeroOrden']?String(qp['numeroOrden'])['replace'](/^0+/,''):null,qF=qp['codigoCaja']?String(qp['codigoCaja'])['trim']():null;if(qR&&qF){let qa=null;if(IL['has'](qR))qa=IL['get'](qR);else{qI['add'](qR);try{let qD;if(qe==='ALL'||qe==='Indefinida'){const qV=await db['collectionGroup']('orders')['where'](firebase['firestore']['FieldPath']['documentId'](),'==',qR)['limit'](0x1)['get']();if(!qV['empty'])qD=qV['docs'][0x0];}else{const qC=await db['collection']('areas')['doc'](qe)['collection']('orders')['doc'](qR)['get']();if(qC['exists'])qD=qC;}qD?(qa=qD['data'](),qa?(IL['set'](qR,qa),qq['add'](qR)):IL['set'](qR,null)):IL['set'](qR,null);}catch(qS){console['error']('[TermConf]\x20Error\x20buscando\x20orden\x20'+qR+':',qS),IL['set'](qR,null);}}if(qa&&qa['catalogNumber']&&Array['isArray'](qa['empaqueData'])){const qj=qa['catalogNumber'],qW=IG(qj,qe);if(qW>0x0){const qK=qa['empaqueData']['find'](qH=>qH['boxId']===qF);if(qK&&Array['isArray'](qK['serials'])){const qH=qK['serials']['length'];if(qH>0x0){const qm=qH*qW;q7+=qm,qQ++,!qf[qR]&&(qf[qR]={}),!qf[qR][qj]&&(qf[qR][qj]={'piezas':0x0,'terminaciones':0x0}),qf[qR][qj]['piezas']+=qH,qf[qR][qj]['terminaciones']+=qm;}}}}}}}Ix(q7,q8,q9,q3,Ir,q0,qf);}catch(qh){console['error']('[TermConf]\x20Error:',qh),q5&&(q5['innerHTML']='<h4\x20style=\x27color:\x20var(--danger-color);\x20text-align:\x20center;\x27>Error</h4><p\x20style=\x27text-align:\x20center;\x27>'+qh['message']+'</p>');}finally{const qx=I('calcularTerminacionesDiaBtn');qx&&(qx['disabled']=![],qx['textContent']='Calcular\x20Terminaciones\x20del\x20Turno');}}function Ix(IA,Ir,q0,q1,q2,q3,q4){const q5=I('terminacionesDashboardContainer');if(!q5)return;const q6=q3==='ALL'?'Todas\x20las\x20츼reas':'츼rea\x20'+q3;let q7='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:\x200;\x20margin-bottom:\x2020px;\x20text-align:\x20center;\x20color:\x20var(--text-primary);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Resumen\x20Terminaciones\x20('+q1+'\x20-\x20Turno\x20'+q2+'\x20-\x20'+q6+')\x0a\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(150px,\x201fr));\x20gap:\x2015px;\x20text-align:\x20center;\x20margin-bottom:\x2025px;\x20border-bottom:\x201px\x20solid\x20var(--border-color);\x20padding-bottom:\x2025px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background-color:\x20var(--surface-color);\x20padding:\x2015px;\x20border-radius:\x208px;\x20border:\x201px\x20solid\x20var(--border-color);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-size:\x201.8em;\x20font-weight:\x20bold;\x20color:\x20var(--primary-color);\x20display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+IA['toLocaleString']()+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-size:\x200.9em;\x20color:\x20var(--text-secondary);\x20display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Terminaciones\x20Totales\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background-color:\x20var(--surface-color);\x20padding:\x2015px;\x20border-radius:\x208px;\x20border:\x201px\x20solid\x20var(--border-color);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-size:\x201.8em;\x20font-weight:\x20bold;\x20color:\x20var(--text-primary);\x20display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+Ir['toLocaleString']()+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-size:\x200.9em;\x20color:\x20var(--text-secondary);\x20display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Tarimas\x20Confirmadas\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background-color:\x20var(--surface-color);\x20padding:\x2015px;\x20border-radius:\x208px;\x20border:\x201px\x20solid\x20var(--border-color);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-size:\x201.8em;\x20font-weight:\x20bold;\x20color:\x20var(--text-primary);\x20display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+q0['toLocaleString']()+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-size:\x200.9em;\x20color:\x20var(--text-secondary);\x20display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Cajas\x20Registradas\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20';q7+='<h5\x20style=\x22margin-top:\x200;\x20margin-bottom:\x2015px;\x20text-align:\x20center;\x20color:\x20var(--text-secondary);\x22>Desglose\x20por\x20Orden\x20y\x20Cat치logo</h5>';const q8=Object['keys'](q4)['sort']();if(q8['length']>0x0){q7+='<div\x20class=\x22table-wrapper\x22\x20style=\x22max-height:\x2040vh;\x20overflow-y:\x20auto;\x22>',q7+='<table\x20style=\x22width:\x20100%;\x20table-layout:\x20auto;\x22>',q7+='<thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22text-align:\x20left;\x20padding:\x208px\x2010px;\x22>Orden</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22text-align:\x20left;\x20padding:\x208px\x2010px;\x22>Cat치logo</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22text-align:\x20right;\x20padding:\x208px\x2010px;\x22>Piezas</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22text-align:\x20right;\x20padding:\x208px\x2010px;\x22>Terminaciones</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</thead><tbody>';for(const q9 of q8){const qI=Object['keys'](q4[q9])['sort']();for(const qq of qI){const qQ=q4[q9][qq];q7+='<tr\x20style=\x22border-bottom:\x201px\x20solid\x20var(--border-color);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x206px\x2010px;\x22>'+q9+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x206px\x2010px;\x22>'+qq+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22text-align:\x20right;\x20padding:\x206px\x2010px;\x22>'+qQ['piezas']['toLocaleString']()+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22text-align:\x20right;\x20padding:\x206px\x2010px;\x20font-weight:\x20bold;\x22>'+qQ['terminaciones']['toLocaleString']()+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>';}}q7+='</tbody></table></div>';}else q7+='<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-dark);\x22>No\x20se\x20encontraron\x20datos\x20detallados\x20para\x20el\x20resumen.</p>';q5['innerHTML']=q7,q5['style']['display']='block';}const IZ=new Map(),IL=new Map();async function IN(IA){const Ir=String(IA)['replace'](/^0+/,'');if(IZ['has'](Ir)){const q0=IZ['get'](Ir);return q0;}else return console['warn']('[TermConf\x20Cache]\x20Orden\x20'+Ir+'\x20no\x20encontrada\x20en\x20la\x20cach칠\x20inicial.'),null;}function IG(IA,Ir='Default'){if(!IA||typeof IA!=='string'||IA['length']<0x4)return 0x0;const q0=P['terminaciones_areas_config']||{},q1=q0[Ir]||q0['Default']||[],q2=IA['toUpperCase'](),q3=q1['sort']((q7,q8)=>q8['prefijo']['length']-q7['prefijo']['length']);for(const q7 of q3){if(q7['prefijo']&&q2['startsWith'](q7['prefijo'])){const q8=q7['longitud']||0x1,q9=q7['posicion']-0x1,qI=q9+q8,qq=(IA['substring'](q9,qI)||'')['toUpperCase']();if(q7['t_es_12']&&qq==='T')return 0xc;const qQ=parseInt(qq,0xa),qf=isNaN(qQ)?0x0:qQ;return qf;}}const q4=q1['find'](qn=>qn['prefijo']==='');if(q4){const qn=q4['longitud']||0x1,qB=q4['posicion']-0x1,qP=qB+qn,qw=(IA['substring'](qB,qP)||'')['toUpperCase']();if(q4['t_es_12']&&qw==='T')return 0xc;const qo=parseInt(qw,0xa);return isNaN(qo)?0x0:qo;}const q5=IA['substring'](0x3,0x4)['toUpperCase']();if(q5==='T')return 0xc;const q6=parseInt(q5,0xa);return isNaN(q6)?0x0:q6;}function IM(){const IA=P['terminaciones_areas_config']||{},Ir=I('prodTarimas_area')['innerHTML'],q0='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22control-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22configAreaSelect\x22>Seleccionar\x20츼rea\x20para\x20Configurar</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<select\x20id=\x22configAreaSelect\x22\x20class=\x22control-group\x20select\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+Ir['replace']('<option\x20value=\x22ALL\x22>Todas\x20las\x20츼reas</option>','')['replace']('value=\x22\x22\x20disabled','value=\x22Default\x22')['replace']('Cargando\x20치reas...','Default\x20(Reglas\x20Globales)')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</select>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<hr\x20style=\x22border-color:\x20var(--border-color);\x20margin:\x2016px\x200;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:center;\x20color:\x20var(--text-dark);\x20font-size:\x200.9em;\x22>Define\x20reglas\x20de\x20prefijo\x20para\x20los\x20cat치logos\x20de\x20esta\x20치rea.\x20La\x20app\x20usar치\x20la\x20primera\x20regla\x20que\x20coincida\x20(la\x20m치s\x20espec칤fica).\x20Si\x20ninguna\x20coincide,\x20usar치\x20la\x20l칩gica\x20por\x20defecto.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22param-list\x22\x20id=\x22areaRulesList\x22\x20style=\x22max-height:\x2040vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22addAreaRuleBtn\x22\x20class=\x22btn\x20btn-glass\x22\x20style=\x22width:\x20auto;\x20padding:\x208px\x2016px;\x22>A침adir\x20Regla</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22saveAreaConfigBtn\x22\x20class=\x22btn\x22\x20style=\x22margin-top:\x2020px;\x20width:\x20100%;\x22>Guardar\x20Configuraci칩n\x20de\x20츼reas</button>\x0a\x20\x20\x20\x20';W('Configurar\x20C치lculo\x20de\x20Fibras\x20por\x20츼rea',q0);const q1=I('configAreaSelect');q1['addEventListener']('change',()=>{Iy(q1['value']);}),I('addAreaRuleBtn')['addEventListener']('click',()=>{const q2=I('areaRulesList');q2['insertAdjacentHTML']('beforeend',IT({'prefijo':'','posicion':0x4,'t_es_12':!![]}));}),I('saveAreaConfigBtn')['addEventListener']('click',Ib),Iy(q1['value']);}function Iy(IA){const Ir=I('areaRulesList');if(!Ir)return;const q0=P['terminaciones_areas_config']||{},q1=q0[IA]||[];Ir['innerHTML']=q1['map'](q2=>IT(q2))['join'](''),q1['length']===0x0&&(Ir['innerHTML']='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-dark);\x22>No\x20hay\x20reglas\x20para\x20esta\x20치rea.\x20Se\x20usar치\x20la\x20l칩gica\x20por\x20defecto\x20(4to\x20d칤gito).</p>');}function IT(IA){return'\x0a\x20\x20\x20\x20<li\x20class=\x22param-item\x22\x20style=\x22grid-template-columns:\x202fr\x201fr\x201fr\x20auto\x20auto;\x20gap:\x2012px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22rule-prefix\x22\x20placeholder=\x22Prefijo\x20(ej:\x20123-)\x22\x20value=\x22'+(IA['prefijo']||'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20class=\x22rule-pos\x22\x20placeholder=\x22Pos.\x20Inicio\x22\x20value=\x22'+(IA['posicion']||0x4)+'\x22\x20min=\x221\x22\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20class=\x22rule-length\x22\x20placeholder=\x22Cant.\x20D칤gitos\x22\x20value=\x22'+(IA['longitud']||0x1)+'\x22\x20min=\x221\x22\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20gap:\x205px;\x20font-size:\x200.9em;\x20justify-content:\x20center;\x20color:\x20var(--text-secondary);\x20cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22rule-t\x22\x20'+(IA['t_es_12']?'checked':'')+'>\x20\x27T\x27\x20es\x2012\x0a\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-danger\x22\x20onclick=\x22this.parentElement.remove()\x22\x20style=\x22padding:\x206px\x2010px;\x20font-size:\x200.9rem;\x22>X</button>\x0a\x20\x20\x20\x20</li>\x0a\x20\x20\x20\x20';}async function Ib(){const IA=I('modalBody'),Ir=I('configAreaSelect')['value'];if(!Ir){W('Error','<p>No\x20se\x20seleccion칩\x20ning칰n\x20치rea.</p>');return;}const q0=Array['from'](IA['querySelectorAll']('#areaRulesList\x20.param-item'))['map'](q1=>({'prefijo':q1['querySelector']('.rule-prefix')['value']['trim']()['toUpperCase'](),'posicion':parseInt(q1['querySelector']('.rule-pos')['value'],0xa)||0x4,'longitud':parseInt(q1['querySelector']('.rule-length')['value'],0xa)||0x1,'t_es_12':q1['querySelector']('.rule-t')['checked']}));!P['terminaciones_areas_config']&&(P['terminaciones_areas_config']={});P['terminaciones_areas_config'][Ir]=q0;try{await db['collection']('report_configs')['doc']('terminaciones_areas_params')['set'](P['terminaciones_areas_config']),W('칄xito','<p>Configuraci칩n\x20para\x20el\x20치rea\x20<strong>'+Ir+'</strong>\x20guardada.</p>');}catch(q1){console['error']('Error\x20guardando\x20config\x20de\x20치reas:',q1),W('Error','<p>No\x20se\x20pudo\x20guardar\x20la\x20configuraci칩n\x20en\x20la\x20base\x20de\x20datos.</p>');}}I('reporteOrdenesDiaBtn')['addEventListener']('click',()=>{V('ordenesDia'),It();if(!I('ordenesDia_fecha')['value']){const IA=new Date(),Ir=new Date(IA['getTime']()-IA['getTimezoneOffset']()*0xea60)['toISOString']()['split']('T')[0x0];I('ordenesDia_fecha')['value']=Ir;}}),I('consultarOrdenesDiaBtn')['addEventListener']('click',Ik);async function It(){const IA=I('ordenesDia_area');if(!IA)return;if(IA['options']['length']>0x1)return;IA['innerHTML']='<option\x20value=\x22\x22\x20disabled\x20selected>Cargando...</option>';try{const Ir=await db['collection']('areas')['get']();IA['innerHTML']='<option\x20value=\x22\x22\x20disabled\x20selected>Seleccione\x20츼rea</option>';const q0=[];Ir['forEach'](q1=>{if(q1['id']!=='CONFIG')q0['push'](q1['id']);}),q0['sort'](),q0['forEach'](q1=>{const q2=document['createElement']('option');q2['value']=q1,q2['textContent']=q1,IA['appendChild'](q2);});if(q0['includes']('MULTIPORT'))IA['value']='MULTIPORT';}catch(q1){console['error']('Error\x20cargando\x20치reas',q1),IA['innerHTML']='<option\x20value=\x22\x22\x20disabled>Error</option>';}}function IO(IA){if(!IA)return null;if(typeof IA==='number'){const Ir=new Date(Math['round']((IA-0x63e1)*0x15180*0x3e8));return Ir['toISOString']()['split']('T')[0x0];}if(IA instanceof Date)return IA['toISOString']()['split']('T')[0x0];if(typeof IA==='string'){if(IA['includes']('/')){const q0=IA['split']('/');if(q0['length']===0x3)return q0[0x2]+'-'+q0[0x1]['padStart'](0x2,'0')+'-'+q0[0x0]['padStart'](0x2,'0');}return IA['substring'](0x0,0xa);}if(IA&&typeof IA['toDate']==='function')return IA['toDate']()['toISOString']()['split']('T')[0x0];return null;}function g(IA){if(!(IA instanceof Date)||isNaN(IA))return'';const Ir=String(IA['getDate']())['padStart'](0x2,'0'),q0=String(IA['getMonth']()+0x1)['padStart'](0x2,'0'),q1=String(IA['getHours']())['padStart'](0x2,'0'),q2=String(IA['getMinutes']())['padStart'](0x2,'0');return Ir+'/'+q0+'\x20'+q1+':'+q2;}async function Ik(){const IA=I('ordenesDia_fecha')['value'],Ir=I('ordenesDia_area')['value'];if(!IA||!Ir){W('Datos\x20Requeridos','<p>Seleccione\x20fecha\x20y\x20치rea.</p>');return;}const q0=I('consultarOrdenesDiaBtn');q0['disabled']=!![],q0['textContent']='Consultando\x20puntual...';const q1=I('dataTableOrdenesDia')['querySelector']('tbody');q1['innerHTML']='<tr><td\x20colspan=\x2211\x22\x20style=\x22text-align:center;\x22>Consultando\x20SAP\x20y\x20Datos\x20Espec칤ficos...</td></tr>',['kpiOrdersTotal','kpiOrdersClosed','kpiOrdersMissing','kpiTerminacionesMissing']['forEach'](q2=>{const q3=I(q2);if(q3)q3['textContent']='-';});try{console['log']('>>>\x20CONSULTA\x20SMART:\x20'+Ir+'\x20|\x20'+IA+'\x20<<<');const q2=db['collection']('areas')['doc'](Ir)['collection']('sap_historico'),q3=await q2['get'](),q4=new Map();q3['forEach'](qf=>{const qn=qf['data'](),qB=IO(qn['Finish']);if(qB===IA){const qP=String(qn['Orden']||qf['id'])['trim']()['replace'](/^0+/,'');q4['set'](qP,qn);}});if(q4['size']===0x0){Iz([]);if(I('kpiTerminacionesMissing'))I('kpiTerminacionesMissing')['textContent']='0';['kpiOrdersTotal','kpiOrdersClosed','kpiOrdersMissing']['forEach'](qf=>I(qf)['textContent']='0'),alert('No\x20hay\x20칩rdenes\x20programadas\x20en\x20SAP\x20para\x20la\x20fecha\x20'+IA+'.'),q0['disabled']=![],q0['textContent']='Consultar\x20칍rdenes';return;}const q5=Array['from'](q4['keys']()),q6=db['collection']('areas')['doc'](Ir)['collection']('orders'),q7=q5['map'](qf=>q6['doc'](qf)['get']()),q8=await Promise['all'](q7),q9=new Map();q8['forEach'](qf=>{qf['exists']&&q9['set'](qf['id'],qf['data']());});let qI=[],qq={'total':0x0,'cerradas':0x0,'faltantes':0x0,'terminacionesPendientes':0x0,'byFibra':{}};q4['forEach']((qf,qn)=>{const qB=q9['get'](qn),qP=qf['Catalogo']||'N/A',qw=qf['Material']||'N/A',qo=qf['Special\x20Stock']||'N/A',qd=Number(qf['Total\x20orden'])||0x0,qY=Number(qf['Total\x20confirmado'])||0x0;let qe=0x0;if(qB){qe=Number(qB['packedQty'])||0x0;if(qe===0x0&&qB['empaqueData']){let qC=[];if(Array['isArray'](qB['empaqueData']))qC=qB['empaqueData'];else{if(typeof qB['empaqueData']==='object')qC=Object['values'](qB['empaqueData']);}qC['forEach'](qS=>{if(qS['serials'])qe+=qS['serials']['length'];});}}let qp=0x0;qf['Faltante']!==undefined?qp=Number(qf['Faltante']):qp=Math['max'](0x0,qd-qY);const qR=Math['max'](0x0,qd-qe),qF=qP['substring'](0x3,0x4)['toUpperCase'](),qa=qF==='T'?0xc:parseInt(qF,0xa)||0x0,qD=qp*qa,qV=qR===0x0&&qd>0x0?'Completa':'Incompleta';qI['push']({'id':qn,'catalogo':qP,'material':qw,'specialStock':qo,'fibras':qa,'termFaltante':qD,'totalOrden':qd,'totalConfirmadoSAP':qY,'faltanteSAP':qp,'faltanteFWD':qR,'status':qV,'rawData':qB||{'packedQty':0x0,'orderQty':qd,'empaqueData':[],'rastreoData':[]}}),qq['total']++,qq['terminacionesPendientes']+=qD;if(qD>0x0){const qS=qa+'\x20Fibras';qq['byFibra'][qS]=(qq['byFibra'][qS]||0x0)+qD;}if(qR===0x0&&qd>0x0)qq['cerradas']++;else qq['faltantes']++;});qI['length']===0x0?Iz([]):Iz(qI);I('kpiOrdersTotal')['textContent']=qq['total'],I('kpiOrdersClosed')['textContent']=qq['cerradas'],I('kpiOrdersMissing')['textContent']=qq['faltantes'];const qQ=I('kpiTerminacionesMissing');if(qQ){qQ['textContent']=qq['terminacionesPendientes']['toLocaleString']();const qf=qQ['closest']('.kpi-card');qf&&(qf['style']['cursor']='pointer',qf['title']='Clic\x20para\x20ver\x20desglose\x20por\x20fibra',qf['onclick']=()=>Iv(qq['byFibra'],qq['terminacionesPendientes']));}}catch(qn){console['error']('Error\x20consulta:',qn),W('Error','<p>'+qn['message']+'</p>'),q1['innerHTML']='<tr><td\x20colspan=\x2211\x22>Error\x20al\x20procesar.</td></tr>';}finally{q0['disabled']=![],q0['textContent']='Consultar\x20칍rdenes';}}function Iv(IA,Ir){if(Object['keys'](IA)['length']===0x0){W('Desglose\x20de\x20Terminaciones','<p\x20style=\x22text-align:center;\x22>No\x20hay\x20terminaciones\x20pendientes\x20en\x20SAP.</p>');return;}const q0=Object['keys'](IA)['sort']((q3,q4)=>parseInt(q3)-parseInt(q4));let q1='<ul\x20class=\x22param-list\x22\x20style=\x22margin-top:10px;\x22>';q0['forEach'](q3=>{const q4=IA[q3],q5=Ir>0x0?Math['round'](q4/Ir*0x64):0x0;q1+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<li\x20style=\x22display:block;\x20padding:12px;\x20margin-bottom:8px;\x20background:var(--surface-hover-color);\x20border-radius:8px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;\x20justify-content:space-between;\x20margin-bottom:5px;\x20font-weight:bold;\x20font-size:1.1rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+q3+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+q4['toLocaleString']()+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22width:100%;\x20height:8px;\x20background:rgba(0,0,0,0.2);\x20border-radius:4px;\x20overflow:hidden;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22width:'+q5+'%;\x20height:100%;\x20background:var(--primary-color);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:right;\x20font-size:0.75rem;\x20color:var(--text-secondary);\x20margin-top:2px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+q5+'%\x20del\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}),q1+='</ul>';const q2='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:center;\x20margin-bottom:15px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20style=\x22margin:0;\x20color:var(--text-primary);\x20font-size:2.5rem;\x22>'+Ir['toLocaleString']()+'</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:var(--text-secondary);\x22>Total\x20Terminaciones\x20Pendientes\x20(SAP)</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h5\x20style=\x22border-bottom:1px\x20solid\x20var(--border-color);\x20padding-bottom:5px;\x20margin-bottom:10px;\x22>Desglose\x20por\x20Tipo\x20de\x20Fibra</h5>\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+q1+'\x0a\x20\x20\x20\x20';W('Planeaci칩n\x20de\x20Turno:\x20Terminaciones',q2);}function Iz(IA){const Ir=I('dataTableOrdenesDia'),q0=Ir['querySelector']('thead'),q1=Ir['querySelector']('tbody');q0&&(q0['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Orden</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Cat치logo</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Material</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Special\x20Stock</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Fibras</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Term.\x20(Falt)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Total\x20Orden</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Total\x20Conf.</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Faltante\x20SAP</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Faltante\x20FWD</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Status</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20');if(!IA||IA['length']===0x0){q1['innerHTML']='<tr><td\x20colspan=\x2211\x22\x20style=\x22text-align:center;\x22>Sin\x20datos\x20para\x20mostrar.</td></tr>';return;}IA['sort']((q3,q4)=>q3['faltanteSAP']-q4['faltanteSAP']);let q2='';IA['forEach']((q3,q4)=>{const q5=q3['faltanteFWD']===0x0,q6=q5?'row-today':'',q7=q5?'var(--success-color)':'#f59e0b',q8=!!q3['rawData'],q9=q8?'1':'0.5',qI=q3['faltanteFWD']===0x0&&q3['faltanteSAP']>0x0?'var(--success-color)':'inherit';q2+='<tr\x20class=\x22'+q6+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22font-weight:bold;\x22>'+q3['id']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+q3['catalogo']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+q3['material']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+q3['specialStock']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22text-align:center;\x22>'+q3['fibras']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22text-align:center;\x20font-weight:bold;\x22>'+q3['termFaltante']['toLocaleString']()+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22text-align:center;\x22>'+q3['totalOrden']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22text-align:center;\x22>'+q3['totalConfirmadoSAP']+'</td>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22text-align:center;\x20font-weight:bold;\x22>'+q3['faltanteSAP']+'</td>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22text-align:center;\x20font-weight:bold;\x20color:'+qI+';\x22>'+q3['faltanteFWD']+'</td>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22text-align:center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-status\x22\x20data-index=\x22'+q4+'\x22\x20style=\x22opacity:'+q9+';\x20border-color:'+q7+';\x20color:'+(q7==='#f59e0b'?'var(--text-primary)':'white')+';\x20background-color:'+(q7==='#f59e0b'?'transparent':q7)+';\x20padding:\x204px\x208px;\x20font-size:\x200.75rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Ver\x20Estatus\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</tr>';}),q1['innerHTML']=q2,Ir['querySelectorAll']('.btn-status')['forEach'](q3=>{q3['addEventListener']('click',q4=>{const q5=q4['target']['dataset']['index'];if(IA[q5]['rawData'])Ii(IA[q5]);else W('Aviso','<p>Orden\x20en\x20SAP\x20sin\x20registros\x20en\x20App.</p>');});});}let IE=null;async function Ii(IA){const Ir=IA['rawData'];if(!Ir){W('Sin\x20Datos','<p>Esta\x20orden\x20a칰n\x20no\x20tiene\x20registros\x20de\x20actividad\x20en\x20la\x20aplicaci칩n.</p>');return;}const q0=Ir['empaqueData']||[],q1=Ir['rastreoData']||[];let q2=Number(Ir['packedQty'])||0x0;q2===0x0&&Array['isArray'](q0)&&q0['forEach'](qe=>{if(Array['isArray'](qe['serials']))q2+=qe['serials']['length'];});const q3=Number(Ir['orderQty'])||Number(IA['totalOrden'])||0x0,q4=P['produccion_hora_config']['packers']||[],q5=qe=>{if(!qe)return null;const qp=q4['find'](qR=>qR['id']===String(qe)['trim']()['toUpperCase']());return qp?'L칤nea\x20'+qp['linea']+'\x20('+qp['turno']+')':null;};let q6={'name':'Sin\x20datos','time':new Date(0x0),'line':'N/A'};const q7={};let q8=0x18,q9=0x0,qI=Array['isArray'](q0)?q0:[];q0&&typeof q0['forEach']==='function'&&!Array['isArray'](q0)&&q0['forEach'](qe=>qI['push'](qe));qI['forEach'](qe=>{qe['serials']&&Array['isArray'](qe['serials'])&&qe['serials']['forEach'](qp=>{const qR=qp['Finish\x20Packed\x20Date'];let qF=null;if(typeof qR==='number'){const qa=new Date(Math['round']((qR-0x63e1)*0x5265c00));qF=new Date(qa['getTime']()+qa['getTimezoneOffset']()*0xea60);}else{if(qR)qF=new Date(qR);}if(qF&&!isNaN(qF)){qF>q6['time']&&(q6['time']=qF,q6['name']=qp['Employee\x20ID']||'Desconocido',q6['line']=q5(q6['name'])||qp['Line']||qp['Linea']||qp['Estaci칩n']||'N/A');const qD=qF['getHours']();if(qD<q8)q8=qD;if(qD>q9)q9=qD;q7[qD]=(q7[qD]||0x0)+0x1;}});});const qq=[],qQ=[];if(q9>=q8)for(let qe=q8;qe<=q9;qe++){qq['push'](String(qe)['padStart'](0x2,'0')+':00'),qQ['push'](q7[qe]||0x0);}const qf={},qn=new Date();Array['isArray'](q1)&&q1['forEach'](qp=>{if(String(qp['Is\x20Scrap']||'')['trim']()['toUpperCase']()==='X')return;const qR=qp['Line']||qp['Linea']||qp['Station']||'L칤nea\x20Desconocida',qF=qp['Product\x20Serial\x20Number']||'S#?',qa=qp['Station']||'Estaci칩n?';let qD=null;if(typeof qp['Date\x20Registered']==='number'){const qS=new Date(Math['round']((qp['Date\x20Registered']-0x63e1)*0x5265c00));qD=new Date(qS['getTime']()+qS['getTimezoneOffset']()*0xea60);}else{if(qp['Date\x20Registered'])qD=new Date(qp['Date\x20Registered']);else{if(qp['Date'])qD=typeof qp['Date']['toDate']==='function'?qp['Date']['toDate']():new Date(qp['Date']);}}let qV='dot-yellow',qC='S/F';if(qD&&!isNaN(qD)){const qj=(qn-qD)/0x36ee80;if(qj>0x19)qV='dot-orange',qC='>\x2025h';else qj>0x8?(qV='dot-yellow',qC='>\x208h'):(qV='dot-green',qC=g(qD));}if(!qf[qR])qf[qR]=[];qf[qR]['push']({'serial':qF,'station':qa,'timeText':qC,'dotClass':qV,'dateObj':qD});});let qB='<div\x20class=\x22line-status-grid\x22>';const qP=Object['keys'](qf)['sort']();if(qP['length']===0x0)qB+='<p\x20style=\x22text-align:center;\x20color:var(--text-secondary);\x20margin-top:20px;\x22>No\x20hay\x20seriales\x20activos\x20en\x20rastreo.</p>';else qP['forEach'](qp=>{const qR=qf[qp];qR['sort']((qa,qD)=>(qD['dateObj']||0x0)-(qa['dateObj']||0x0));let qF='';qR['forEach'](qa=>{qF+='<li\x20class=\x22line-item\x22><span\x20class=\x22status-indicator-dot\x20'+qa['dotClass']+'\x22></span><div\x20class=\x22item-details\x22><div\x20class=\x22item-top\x22><span>'+qa['serial']+'</span><span\x20style=\x22font-size:0.8em;\x20opacity:0.8;\x22>'+qa['timeText']+'</span></div><div\x20class=\x22item-bottom\x22><span>'+qa['station']+'</span></div></div></li>';}),qB+='<div\x20class=\x22line-detail-card\x22><div\x20class=\x22line-card-header\x22><span>'+qp+'</span><span\x20style=\x22background:rgba(255,255,255,0.1);\x20padding:2px\x208px;\x20border-radius:12px;\x20font-size:0.85em;\x22>'+qR['length']+'\x20pzas</span></div><ul\x20class=\x22line-items-list\x22>'+qF+'</ul></div>';});qB+='</div>';const qw=q6['time']['getTime']()>0x0?q6['time']['toLocaleString']('es-MX',{'hour':'2-digit','minute':'2-digit','hour12':![]}):'N/A',qo=q2>=q3&&q3>0x0?'color:var(--success-color);':'color:var(--danger-color);',qd='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin:0;\x20color:var(--text-primary);\x20font-size:1.1rem;\x22>Orden:\x20'+IA['id']+'</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:var(--text-secondary);\x20font-size:0.9rem;\x22>'+IA['catalogo']+'</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:right;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-weight:bold;\x20font-size:1.4rem;\x20'+qo+'\x22>'+q2+'\x20/\x20'+q3+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><small\x20style=\x22font-size:0.8rem;\x22>Progreso\x20Real</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-left-column\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:\x2020px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h5\x20style=\x22margin:0\x200\x2010px\x200;\x20color:var(--text-secondary);\x22>Ritmo\x20de\x20Empaque\x20(Pzas/Hora)</h5>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-chart-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22modalHourlyChart\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22last-packer-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h5\x20style=\x22margin:0\x200\x208px\x200;\x20color:var(--primary-color);\x22>칔ltimo\x20Empaque\x20Detectado</h5>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x200.9rem;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;\x20justify-content:space-between;\x20margin-bottom:4px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>Usuario:</span>\x20<strong>'+q6['name']+'</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;\x20justify-content:space-between;\x20margin-bottom:4px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>Hora:</span>\x20<strong>'+qw+'</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22border-top:1px\x20solid\x20rgba(0,0,0,0.1);\x20padding-top:4px;\x20margin-top:4px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22color:var(--text-secondary);\x20font-size:0.85em;\x22>L칤nea:</span>\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>'+q6['line']+'</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-right-column\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h5\x20style=\x22margin:0\x200\x2015px\x200;\x20color:var(--text-secondary);\x20position:sticky;\x20top:0;\x20background:var(--surface-color);\x20padding-bottom:5px;\x20z-index:10;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Detalle\x20de\x20Rastreo\x20(Activos:\x20'+qP['reduce']((qp,qR)=>qp+qf[qR]['length'],0x0)+')\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h5>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+qB+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20';W('Detalle\x20de\x20Estatus\x20de\x20Orden',qd),I('modalContent')['classList']['add']('modal-wide'),setTimeout(()=>IU(qq,qQ),0x64);const qY=()=>{I('modalContent')['classList']['remove']('modal-wide'),I('modalClose')['removeEventListener']('click',qY);};I('modalClose')['addEventListener']('click',qY),I('modalOverlay')['addEventListener']('click',qp=>{if(qp['target']===I('modalOverlay'))qY();});}function IU(IA,Ir){const q0=document['getElementById']('modalHourlyChart');if(!q0)return;IE&&(IE['destroy'](),IE=null);if(Ir['length']===0x0)return;const q1=getComputedStyle(document['body'])['getPropertyValue']('--primary-color')['trim']()||'#34D399',q2='rgba(255,\x20255,\x20255,\x200.1)',q3=getComputedStyle(document['body'])['getPropertyValue']('--text-secondary')['trim']();IE=new Chart(q0,{'type':'bar','data':{'labels':IA,'datasets':[{'label':'Piezas\x20Empacadas','data':Ir,'backgroundColor':q1,'borderRadius':0x4,'borderWidth':0x0}]},'options':{'responsive':!![],'maintainAspectRatio':![],'plugins':{'legend':{'display':![]},'title':{'display':![]},'tooltip':{'callbacks':{'label':function(q4){return q4['raw']+'\x20piezas';}}},'datalabels':{'display':!![],'color':q3,'anchor':'end','align':'top','offset':-0x2,'font':{'size':0xa,'weight':'bold'},'formatter':q4=>q4>0x0?q4:''}},'scales':{'y':{'beginAtZero':!![],'grid':{'color':q2,'drawBorder':![]},'ticks':{'color':q3,'font':{'size':0xa}}},'x':{'grid':{'display':![]},'ticks':{'color':q3,'font':{'size':0xa}}}}},'plugins':[ChartDataLabels]});}const Ic=document['getElementById']('btnProyeccionTerminaciones');Ic&&Ic['addEventListener']('click',Is);function Is(){const IA=new Date()['toISOString']()['split']('T')[0x0],Ir=document['getElementById']('ordenesDia_area')['value']||'',q0='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22control-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>츼rea\x20a\x20Consultar</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<select\x20id=\x22proyeccion_area\x22\x20class=\x22filter-input\x22\x20style=\x22width:100%;\x20padding:8px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+document['getElementById']('ordenesDia_area')['innerHTML']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</select>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22date-range-grid\x22\x20style=\x22display:\x20grid;\x20grid-template-columns:\x201fr\x201fr;\x20gap:\x2010px;\x20margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Fecha\x20Inicio</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22date\x22\x20id=\x22proyeccion_f_inicio\x22\x20value=\x22'+IA+'\x22\x20style=\x22width:100%;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Fecha\x20Fin</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22date\x22\x20id=\x22proyeccion_f_fin\x22\x20value=\x22'+IA+'\x22\x20style=\x22width:100%;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22btnGenerarPivot\x22\x20class=\x22btn\x22\x20style=\x22width:100%;\x20margin-top:\x2020px;\x22>Generar\x20Tabla\x20Pivote</button>\x0a\x20\x20\x20\x20';W('Proyecci칩n\x20de\x20Terminaciones',q0);if(Ir)document['getElementById']('proyeccion_area')['value']=Ir;document['getElementById']('btnGenerarPivot')['addEventListener']('click',IX);}async function IX(){const IA=document['getElementById']('proyeccion_f_inicio')['value'],Ir=document['getElementById']('proyeccion_f_fin')['value'],q0=document['getElementById']('proyeccion_area')['value'],q1=document['getElementById']('btnGenerarPivot');if(!IA||!Ir||!q0){alert('Selecciona\x20rango\x20de\x20fechas\x20y\x20치rea.');return;}q1['disabled']=!![],q1['textContent']='Consultando\x20SAP...';try{const q2=q9=>{const qI=new Date(q9+'T00:00:00'),qq=qI['getTimezoneOffset']()*0xea60,qQ=new Date(qI['getTime']()-qq);return qQ['getTime']()/0x5265c00+0x63e1;},q3=Math['floor'](q2(IA)),q4=Math['floor'](q2(Ir))+0x1;let q5=db['collection']('areas')['doc'](q0)['collection']('sap_historico');q5=q5['where']('Finish','>=',q3)['where']('Finish','<',q4);const q6=await q5['get']();if(q6['empty']){W('Sin\x20Datos\x20SAP','<p>No\x20se\x20encontraron\x20칩rdenes\x20pendientes\x20en\x20SAP\x20para\x20este\x20rango.</p>');return;}const q7={},q8=new Set();q6['forEach'](q9=>{const qI=q9['data'](),qq=X(qI['Finish']);if(qq){const qQ=qq['toLocaleDateString']('es-MX',{'day':'2-digit','month':'2-digit','year':'numeric'}),qf=Number(qI['Faltante'])||0x0;if(qf>0x0){const qn=qI['Catalogo']||'';let qB=0x0;if(typeof IG==='function')qB=IG(qn,q0);else{const qP=qn['substring'](0x3,0x4)['toUpperCase']();qB=qP==='T'?0xc:parseInt(qP,0xa)||0x0;}if(qB>0x0){const qw=qB+'\x20Fibras';q8['add'](qw);const qo=qB*qf;if(!q7[qQ])q7[qQ]={};if(!q7[qQ][qw])q7[qQ][qw]=0x0;q7[qQ][qw]+=qo;}}}}),Ig(q7,Array['from'](q8)['sort']((q9,qI)=>parseInt(q9)-parseInt(qI)));}catch(q9){console['error']('Error\x20proyecci칩n\x20SAP:',q9),q9['code']==='failed-precondition'?W('Falta\x20칈ndice','<p>Firebase\x20necesita\x20un\x20칤ndice\x20compuesto\x20(Finish\x20ASC)\x20para\x20esta\x20consulta.\x20Revisa\x20la\x20consola\x20(F12).</p>'):alert('Error\x20al\x20consultar\x20datos:\x20'+q9['message']);}finally{q1['disabled']=![],q1['textContent']='Generar\x20Tabla\x20Pivote';}}function Ig(IA,Ir){const q0=Object['keys'](IA)['sort']((q5,q6)=>{const q7=new Date(q5['split']('/')['reverse']()['join']('-')),q8=new Date(q6['split']('/')['reverse']()['join']('-'));return q7-q8;});if(q0['length']===0x0){W('Todo\x20Completo','<p\x20style=\x22text-align:center;\x20padding:\x2020px;\x22>九\x20No\x20hay\x20faltantes\x20programados\x20para\x20este\x20periodo.</p>');return;}const q1={};Ir['forEach'](q5=>q1[q5]=0x0);let q2=0x0,q3='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:\x2020px;\x20text-align:\x20left;\x20border-bottom:\x201px\x20solid\x20var(--border-color);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin:\x200;\x20color:\x20var(--text-primary);\x20font-size:\x201.2rem;\x22>Proyecci칩n\x20de\x20Carga\x20de\x20Trabajo\x20(SAP)</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-size:\x200.8rem;\x20color:\x20var(--text-secondary);\x20display:\x20block;\x20margin-top:\x204px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Generado\x20el:\x20'+new Date()['toLocaleString']()+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22table-wrapper\x22\x20style=\x22max-height:\x2060vh;\x20border-radius:\x208px;\x20border:\x201px\x20solid\x20var(--border-color);\x20overflow:\x20hidden;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<table\x20class=\x22pivot-table\x22\x20style=\x22width:100%;\x20border-collapse:collapse;\x20font-size:0.9em;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead\x20style=\x22background:\x20var(--surface-hover-color);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x2012px\x2016px;\x20text-align:\x20left;\x20font-weight:\x20600;\x20color:\x20var(--text-secondary);\x20text-transform:\x20uppercase;\x20font-size:\x200.75rem;\x22>Fecha\x20Entrega</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+Ir['map'](q5=>'<th\x20style=\x22padding:\x2012px;\x20text-align:\x20center;\x20font-weight:\x20600;\x20color:\x20var(--text-secondary);\x20text-transform:\x20uppercase;\x20font-size:\x200.75rem;\x22>'+q5+'</th>')['join']('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x2012px\x2016px;\x20text-align:\x20right;\x20font-weight:\x20600;\x20color:\x20var(--text-primary);\x20text-transform:\x20uppercase;\x20font-size:\x200.75rem;\x22>Total\x20Pendiente</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody\x20style=\x22background:\x20var(--surface-color);\x22>\x0a\x20\x20\x20\x20';q0['forEach'](q5=>{const q6=IA[q5];let q7=0x0;q3+='<tr\x20style=\x22border-bottom:\x201px\x20solid\x20var(--border-color);\x20transition:\x20background\x200.2s;\x22>',q3+='<td\x20style=\x22padding:\x2012px\x2016px;\x20font-weight:\x20500;\x20color:\x20var(--text-primary);\x22>'+q5+'</td>',Ir['forEach'](q8=>{const q9=q6[q8]||0x0;q7+=q9,q1[q8]+=q9;const qI=q9===0x0?'color:\x20var(--text-secondary);\x20opacity:\x200.3;':'color:\x20var(--text-primary);\x20font-weight:\x20500;';q3+='<td\x20style=\x22padding:\x2012px;\x20text-align:\x20center;\x20'+qI+'\x22>'+q9['toLocaleString']()+'</td>';}),q2+=q7,q3+='<td\x20style=\x22padding:\x2012px\x2016px;\x20text-align:\x20right;\x20font-weight:\x20700;\x20color:\x20#ef4444;\x22>'+q7['toLocaleString']()+'</td>',q3+='</tr>';}),q3+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20style=\x22background:\x20var(--surface-hover-color);\x20font-weight:\x20700;\x20border-top:\x202px\x20solid\x20var(--border-color);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x2014px\x2016px;\x20color:\x20var(--text-primary);\x22>TOTAL\x20PERIODO</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+Ir['map'](q5=>'<td\x20style=\x22padding:\x2014px;\x20text-align:\x20center;\x20color:\x20var(--text-primary);\x22>'+q1[q5]['toLocaleString']()+'</td>')['join']('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x2014px\x2016px;\x20text-align:\x20right;\x20font-size:\x201.1em;\x20color:\x20#ef4444;\x22>'+q2['toLocaleString']()+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20<div\x20style=\x22margin-top:\x2020px;\x20display:\x20flex;\x20justify-content:\x20flex-end;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-glass\x22\x20onclick=\x22exportPivotToImage()\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x20padding:\x208px\x2016px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M21\x2015v4a2\x202\x200\x200\x201-2\x202H5a2\x202\x200\x200\x201-2-2v-4\x22/><polyline\x20points=\x227\x2010\x2012\x2015\x2017\x2010\x22/><line\x20x1=\x2212\x22\x20y1=\x2215\x22\x20x2=\x2212\x22\x20y2=\x223\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Exportar\x20Imagen\x0a\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20';const q4=document['getElementById']('modalBody');q4['innerHTML']=q3;}window['exportPivotToImage']=function(){const IA=document['querySelector']('.pivot-table')['parentElement'];if(typeof html2canvas!=='undefined'){const Ir=document['body']['classList']['contains']('dark-theme')?'#1f2937':'#ffffff';html2canvas(IA,{'backgroundColor':Ir})['then'](q0=>{const q1=document['createElement']('a');q1['href']=q0['toDataURL']('image/jpeg'),q1['download']='Proyeccion_Terminaciones.jpg',q1['click']();});}else alert('Librer칤a\x20de\x20imagen\x20no\x20cargada.');};async function IJ(){if(w)return w;try{const IA=await db['collection']('areas')['get'](),Ir=[];return IA['forEach'](q0=>{if(q0['id']!=='CONFIG')Ir['push'](q0['id']);}),Ir['sort'](),w=Ir,console['log']('九\x20츼reas\x20descargadas\x20y\x20guardadas\x20en\x20cach칠.'),Ir;}catch(q0){return console['error']('Error\x20cargando\x20치reas:',q0),[];}}async function Il(IA,Ir=![]){const q0=document['getElementById'](IA);if(!q0)return;if(q0['options']['length']>0x2)return;const q1=q0['value'];if(q0['options']['length']<=0x1)q0['innerHTML']='<option\x20value=\x22\x22\x20disabled\x20selected>Cargando...</option>';const q2=await IJ();let q3='<option\x20value=\x22\x22\x20disabled\x20selected>Seleccione\x20츼rea</option>';if(Ir)q3+='<option\x20value=\x22ALL\x22>Todas\x20las\x20츼reas</option>';q2['forEach'](q4=>{q3+='<option\x20value=\x22'+q4+'\x22>'+q4+'</option>';}),q0['innerHTML']=q3;if(q2['includes']('MULTIPORT')&&!q1)q0['value']='MULTIPORT';else{if(q1)q0['value']=q1;}}async function I7(){await Il('prod_area',![]);}async function J(){await Il('prodTarimas_area',!![]);}async function It(){await Il('ordenesDia_area',![]);}function Iu(){if(sessionStorage['getItem']('reportesMasterSession')==='true')n['isMaster']=!![];Promise['all']([z('901_config'),z('terminaciones_config'),z('produccion_hora_config'),z('terminaciones_areas_config')])['then'](()=>{const IA=new Date(),Ir=new Date();Ir['setDate'](IA['getDate']()-0x6);const q0=q2=>{const q3=q2['getFullYear'](),q4=String(q2['getMonth']()+0x1)['padStart'](0x2,'0'),q5=String(q2['getDate']())['padStart'](0x2,'0');return q3+'-'+q4+'-'+q5;};I('prod_fecha_unica')['value']=q0(IA),I('prod_fecha_inicio')['value']=q0(Ir),I('prod_fecha_fin')['value']=q0(IA);const q1=I4();I('prod_turno')['value']=q1,S(C),Object['values'](q)['forEach'](q2=>{q2['style']['display']='none',q2['style']['opacity']='0';}),q['menu']['style']['display']='flex',q['menu']['style']['opacity']='1';});}Iu();});
